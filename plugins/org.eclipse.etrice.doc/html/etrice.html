<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>eTrice User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="eTrice User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>eTrice User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#eTriceOverview">1. eTrice Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatiseTrice">What is eTrice?</a></span>
</dt>
<dt>
<span class="section"><a href="#WhoshoulduseeTrice">Who should use eTrice?</a></span>
</dt>
<dt>
<span class="section"><a href="#HowDoesItWork">How Does It Work?</a></span>
</dt>
<dt>
<span class="section"><a href="#WhoisBehindeTrice">Who is Behind eTrice?</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#IntroductiontotheROOMLanguage">2. Introduction to the ROOM Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#ScopeofROOM">Scope of ROOM</a></span>
</dt>
<dt>
<span class="section"><a href="#BasicConcepts">Basic Concepts</a></span>
</dt>
<dt>
<span class="section"><a href="#Benefits">Benefits</a></span>
</dt>
<dt>
<span class="section"><a href="#ExecutionModels">Execution Models</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialHelloWorld">3. Tutorial HelloWorld</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Createastatemachine">Create a state machine</a></span>
</dt>
<dt>
<span class="section"><a href="#Buildandrunthemodel">Build and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#OpentheMessageSequenceChart">Open the Message Sequence Chart</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialBlinky">4. Tutorial Blinky</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope2">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch2">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Addtwoadditionalactorclasses">Add two additional actor classes</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewprotocol">Create a new protocol</a></span>
</dt>
<dt>
<span class="section"><a href="#ImporttheTimingService">Import the Timing Service</a></span>
</dt>
<dt>
<span class="section"><a href="#Finishthemodelstructure">Finish the model structure</a></span>
</dt>
<dt>
<span class="section"><a href="#ImplementtheBehavior">Implement the Behavior</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary2">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialSendingData">5. Tutorial Sending Data</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope3">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch3">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Addadataclass">Add a data class</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewprotocol2">Create a new protocol</a></span>
</dt>
<dt>
<span class="section"><a href="#CreateMrPingandMrPongActors">Create MrPing and MrPong Actors</a></span>
</dt>
<dt>
<span class="section"><a href="#DefinetheActorsStructureandBehavior">Define the Actors Structure and Behavior</a></span>
</dt>
<dt>
<span class="section"><a href="#Definethetoplevel">Define the top level</a></span>
</dt>
<dt>
<span class="section"><a href="#Generateandrunthemodel">Generate and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary3">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialPedestrianLights">6. Tutorial Pedestrian Lights</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope4">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Setupthemodel">Setup the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Whydoesitworkandwhyisitsave">Why does it work and why is it save?</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#ROOMConcepts">7. ROOM Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#MainConcepts">Main Concepts</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
<div class="chapter" title="Chapter&nbsp;1.&nbsp;eTrice Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="eTriceOverview"></a>Chapter&nbsp;1.&nbsp;eTrice Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is eTrice?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatiseTrice"></a>What is eTrice?</h2>
</div>
</div>
</div>
<p>eTrice provides an implementation of the ROOM modeling language (Real Time Object Oriented Modeling) together with editors, code generators for Java, C++ and C code and exemplary target middleware.</p>
<p>The model is defined in textual form (Xtext) with graphical editors (Graphiti) for the structural and behavioral (i.e. state machine) parts.  </p>
</div>
<div class="section" title="Who should use eTrice?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhoshoulduseeTrice"></a>Who should use eTrice?</h2>
</div>
</div>
</div>
<p>Basically everyone who develops eventdriven realtime or embedded systems. </p>
<p>If you have other ideas how to use it, tell us!</p>
</div>
<div class="section" title="How Does It Work?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="HowDoesItWork"></a>How Does It Work?</h2>
</div>
</div>
</div>
<p>TODO</p>
</div>
<div class="section" title="Who is Behind eTrice?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhoisBehindeTrice"></a>Who is Behind eTrice?</h2>
</div>
</div>
</div>
<p>TODO</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;Introduction to the ROOM Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="IntroductiontotheROOMLanguage"></a>Chapter&nbsp;2.&nbsp;Introduction to the ROOM Language</h2>
</div>
</div>
</div>
<div class="section" title="Scope of ROOM">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ScopeofROOM"></a>Scope of ROOM</h2>
</div>
</div>
</div>
</div>
<div class="section" title="Basic Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="BasicConcepts"></a>Basic Concepts</h2>
</div>
</div>
</div>
</div>
<div class="section" title="Benefits">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Benefits"></a>Benefits</h2>
</div>
</div>
</div>
</div>
<div class="section" title="Execution Models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ExecutionModels"></a>Execution Models</h2>
</div>
</div>
</div>
<div class="section" title="Logical Machine">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="LogicalMachine"></a>Logical Machine</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>run to completion</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Queue Based Execution Model">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="QueueBasedExecutionModel"></a>Queue Based Execution Model</h3>
</div>
</div>
</div>
</div>
<div class="section" title="Polled Execution Model not implemented yet">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="PolledExecutionModel"></a>Polled Execution Model
					not implemented yet</h3>
</div>
</div>
</div>
</div>
<div class="section" title="Hybrid Execution Model not implemented yet">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="HybridExecutionModel"></a>Hybrid Execution Model
					not implemented yet</h3>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;Tutorial HelloWorld">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialHelloWorld"></a>Chapter&nbsp;3.&nbsp;Tutorial HelloWorld</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope"></a>Scope</h2>
</div>
</div>
</div>
<p>In this tutorial you will build your first very simple etrice model. The goal is to learn the work flow of eTrice and to understand a few basic features of ROOM. You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>add a very simple state machine to an actor</p>
</li>
<li class="listitem">
<p>generate the source code</p>
</li>
<li class="listitem">
<p>run the model</p>
</li>
<li class="listitem">
<p>open the message sequence chart</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>The easiest way to create a new eTrice Project is to use the eclipse project wizard. From the eclipse file menu select 
				[<span class="citation">File-&gt;New-&gt;Project</span>] and create a new eTrice project and name it 
				[<span class="citation">HelloWorld</span>]
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld10.PNG"></div>
<p>
			
</p>
<p>The wizard creates everything that is needed to create, build and run a eTrice model. The resulting project should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld11.PNG"></div>
<p>
			
</p>
<p>Within the model directory the model file 
				[<span class="citation">HelloWorld.room</span>] was created. Open the 
				[<span class="citation">HelloWorld.room</span>] file and position the cursor at the very beginning of the file. Open the content assist with Ctrl+Space and select 
				[<span class="citation">model skeleton</span>].
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld12.PNG"></div>
<p>   
			
</p>
<p>Edit the template variables and remove the artefacts from the wizard. </p>
<p>The resulting model code should look like this:</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;HelloWorld&nbsp;{<br>

<br>
	LogicalSystem&nbsp;System_HelloWorld&nbsp;{<br>
		SubSystemRef&nbsp;subsystem&nbsp;:&nbsp;SubSystem_HelloWorld<br>
	}<br>

<br>
	SubSystemClass&nbsp;SubSystem_HelloWorld&nbsp;{<br>
		ActorRef&nbsp;application&nbsp;:&nbsp;HelloWorldTop<br>
	}<br>

<br>
	ActorClass&nbsp;HelloWorldTop&nbsp;{<br>
	}<br>
}&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The goal of eTrice is to describe distributed systems on a logical level. In the current version not all elements will be supported. But as prerequisite for further versions the following elements are mandatory for an eTrice model:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>the 
						[<span class="citation">LogicalSystem</span>] 
					</p>
</li>
<li class="listitem">
<p>at least one 
						[<span class="citation">SubSystemClass</span>]
					</p>
</li>
<li class="listitem">
<p>at least one 
						[<span class="citation">ActorClass</span>]
					</p>
</li>
</ul>
</div>
<p>The 
				[<span class="citation">LogicalSystem</span>] represents the complete distributed system and contains at least one 
				[<span class="citation">SubSystemRef</span>]. The 
				[<span class="citation">SubSystemClass</span>] represents an address space and contains at least one 
				[<span class="citation">ActorRef</span>]. The 
				[<span class="citation">ActorClass</span>] is the building block of which an application will be build of. It is a good idea to define a top level actor that can be used as reference within the subsystem.
			</p>
<p>Mention that a outline view was created that represents all currently existing model elements in a graphical way.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld02.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Create a state machine">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createastatemachine"></a>Create a state machine</h2>
</div>
</div>
</div>
<p>We will implement the Hello World code on the initial transition of the 
				[<span class="citation">HelloWorldTop</span>] actor. Therefore open the state machine editor by right clicking the 
				[<span class="citation">HelloWorldTop</span>] actor in the outline view and select 
				[<span class="citation">Edit Behavior</span>].
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld03.PNG"></div>
<p>
			
</p>
<p>The state machine editor will be opened. Drag and drop an 
				[<span class="citation">Initial Point</span>] from the tool box to the diagram into the top level state. Drag and drop a 
				[<span class="citation">State</span>] from the tool box to the diagram. Confirm the dialogue with 
				[<span class="citation">ok</span>]. Select the 
				[<span class="citation">Transition</span>] in the tool box and draw the transition from the 
				[<span class="citation">Initial Point</span>] to the State. Open the transition dialogue by double clicking the caption of the transition and fill in the action code.
			</p>
<div class="literallayout">
<p>
<code class="code">System.out.println("Hello&nbsp;World&nbsp;!");<br>

</code>
</p>
</div>
<p>The result should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld04.PNG"></div>
<p>
			
</p>
<p>Save the diagram and inspect the model file. Note that the textual representation was created after saving the diagram.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld05.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Build and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Buildandrunthemodel"></a>Build and run the model</h2>
</div>
</div>
</div>
<p>Now the model is finished and source code can be generated. The project wizard has created a workflow that is responsible to generate the source code. From 
				[<span class="citation">HelloWorld/src/workflow</span>] right click 
				[<span class="citation">HelloWorld.mwe2</span>] and run it as MWE2Workflow. All model files in the model directory will be generated.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld06.PNG"></div>
<p>
			
</p>
<p>The code will be generated to the src-gen directory. The main class will be contained in 
				[<span class="citation">SubSystem_HelloWorldRunner.java</span>]. Select this file and run it as Java application.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld07.PNG"></div>
<p>
			
</p>
<p>The Hello World application starts and the string will be printed on the console window. To stop the application the user must type 
				[<span class="citation">quit</span>] in the console window.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld08.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Open the Message Sequence Chart">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="OpentheMessageSequenceChart"></a>Open the Message Sequence Chart</h2>
</div>
</div>
</div>
<p>During runtime the application produces a MSC and wrote it to a file. Open /org.eclipse.etrice.doc.tutorials/tmp/log/SubSystem_HelloWorld_Async.seq. You should see something like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld09.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary"></a>Summary</h2>
</div>
</div>
</div>
<p>Now you have generated your first eTrice model from scratch. You can switch between diagram editor and model (.room file) and you can see what will be generated during editing and saving the diagram files. 
				You should take a look at the generated source files to understand how the state machine is generated and the life cycle of the application. The next tutorials deals with more complex state machines hierarchies in structure and behavior.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;Tutorial Blinky">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialBlinky"></a>Chapter&nbsp;4.&nbsp;Tutorial Blinky</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope2"></a>Scope</h2>
</div>
</div>
</div>
<p>This tutorial describes how to use the 
				[<span class="citation">TimingService</span>], combine a generated model with manual code and how to modeling a hierarchical state machine. The idea of the tutorial is, to switch a LED on and off. The behavior of the LED should be: blinking in a one second interval for 5 seconds, stop blinking for 5 seconds, blinking, stop,...  
				For this exercise we will use a little GUI class that will be used in more sophisticated tutorials too. The GUI simulates a pedestrian traffic crossing. For now, just a simple LED simulation will be used from the GUI. 
			</p>
<p>To use the GUI please copy the package 
				[<span class="citation">de.protos.PedLightGUI</span>] to your 
				[<span class="citation">src</span>] directory. The package contains four java classes which implements a little window with a 3-light traffic light which simulates the signals for the car traffic and a 2-light traffic light which simulates the pedestrian signals.
			</p>
<p>The GUI looks like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky08.PNG"></div>
<p>
			
</p>
<p>Within this tutorial we just will switching on and off the yellow light.</p>
<p>You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>define a protocol</p>
</li>
<li class="listitem">
<p>create an actor structure</p>
</li>
<li class="listitem">
<p>create a hierarchical state machine</p>
</li>
<li class="listitem">
<p>use the predefined 
						[<span class="citation">TimingService</span>]
					</p>
</li>
<li class="listitem">
<p>combine manual code with generated code</p>
</li>
<li class="listitem">
<p>build and run the model</p>
</li>
<li class="listitem">
<p>open the message sequence chart</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch2"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Remember exercise 
				[<span class="citation">HelloWorld</span>].
				Create a new eTrice project and name it 
				[<span class="citation">Blinky</span>]
				Open the 
				[<span class="citation">Blinky.room</span>] file and copy the following code into the file or use content assist to create the model.
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;Blinky&nbsp;{<br>

<br>
	LogicalSystem&nbsp;System_Blinky&nbsp;{<br>
		SubSystemRef&nbsp;subsystem&nbsp;:&nbsp;SubSystem_Blinky<br>
	}<br>

<br>
	SubSystemClass&nbsp;SubSystem_Blinky&nbsp;{<br>
		ActorRef&nbsp;application&nbsp;:&nbsp;BlinkyTop<br>
	}<br>

<br>
	ActorClass&nbsp;BlinkyTop&nbsp;{<br>
	}<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Add two additional actor classes">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Addtwoadditionalactorclasses"></a>Add two additional actor classes</h2>
</div>
</div>
</div>
<p>Position the cursor outside any class definition and right click the mouse within the editor window. From the context menu select 
				[<span class="citation">Content Assist</span>]  
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky02.png"></div>
<p>
			
</p>
<p>Select 
				[<span class="citation">ActorClass &ndash; actor class skeleton</span>] and name it 
				[<span class="citation">Blinky</span>].
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky01.PNG"></div>
<p> 
			
</p>
<p>Repeat the described procedure and name the new actor 
				[<span class="citation">BlinkyController</span>].
			</p>
<p>Save the model and visit the outline view.</p>
</div>
<div class="section" title="Create a new protocol">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewprotocol"></a>Create a new protocol</h2>
</div>
</div>
</div>
<p>With the help of 
				[<span class="citation">Content Assist</span>] create a 
				[<span class="citation">ProtocolClass</span>] and name it 
				[<span class="citation">BlinkyControlProtocol</span>].
				Inside the brackets use the 
				[<span class="citation">Content Assist</span>] (CTRL+Space) to create two incomming messages called 
				[<span class="citation">start</span>] and 
				[<span class="citation">stop</span>].
			</p>
<p>The resulting code should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky03.PNG"></div>
<p> 
			
</p>
<p>With Ctrl-Shift+F or selecting 
				[<span class="citation">Format</span>] from the context menu you can format the text. Mention that all elements are displayed in the outline view.
			</p>
</div>
<div class="section" title="Import the Timing Service">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ImporttheTimingService"></a>Import the Timing Service</h2>
</div>
</div>
</div>
<p>Switching on and off the LED is timing controlled. Therefore a timing service is needed. To import the timing service in the outline view right click to 
				[<span class="citation">SubSystem_Blinky</span>]. Select 
				[<span class="citation">Edit Structure</span>]. Drag and Drop an 
				[<span class="citation">ActorRef</span>] to the 
				[<span class="citation">SubSystem_Blinky</span>] and name it 
				[<span class="citation">application</span>]. From the actor class drop down list select 
				[<span class="citation">BlinkyTop</span>]. Do the same clicks for the timing service. Name it 
				[<span class="citation">timingService</span>] and from the drop down list select 
				[<span class="citation">room.basic.service.timing.ATimingService</span>]. Draw a 
				[<span class="citation">LayerConnection</span>] from 
				[<span class="citation">application</span>] to each service provision point (SPP) of the 
				[<span class="citation">timingService</span>]. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky06.PNG"></div>
<p> 
			
</p>
<p>The current version of eTrice does not provide a graphical element for a service access point (SAP). Therefore the SAPs to access the timing service must be added in the .room file. Open the 
				[<span class="citation">Blinky.room</span>] file and navigate to the 
				[<span class="citation">Blinky</span>] actor. Add the following line to the structure of the actor:
			</p>
<div class="literallayout">
<p>
<code class="code">SAP&nbsp;timer:&nbsp;room.basic.service.timing.PTimeout<br>

</code>
</p>
</div>
<p>Do the same thing for 
				[<span class="citation">BlinkyController</span>].
			</p>
<p>The resulting code should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky07.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Finish the model structure">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Finishthemodelstructure"></a>Finish the model structure</h2>
</div>
</div>
</div>
<p>From the outline view right click to 
				[<span class="citation">Blinky</span>] and select 
				[<span class="citation">Edit Structure</span>]. Drag and Drop an 
				[<span class="citation">Interface Port</span>] to the boarder of the 
				[<span class="citation">Blinky</span>] actor. Note that an interface port is not possible inside the the actor. Name the port 
				[<span class="citation">ControlPort</span>] and select 
				[<span class="citation">BlinkyControlProtocol</span>] from the drop down list. Uncheck 
				[<span class="citation">Conjugated</span>] and 
				[<span class="citation">Is Relay Port</span>]. Klick 
				[<span class="citation">ok</span>]. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky04.PNG"></div>
<p>
			
</p>
<p>Repeat the above steps for the 
				[<span class="citation">BlinkyController</span>]. Make the port 
				[<span class="citation">Conjugated</span>]
			</p>
<p>Keep in mind that the protocol defines 
				[<span class="citation">start</span>] and 
				[<span class="citation">stop</span>] as incoming messages. 
				[<span class="citation">Blinky</span>] receives this messages and therefore 
				[<span class="citation">Blinky</span>]'s 
				[<span class="citation">ControlPort</span>] must be a base port and 
				[<span class="citation">BlinkyController</span>]'s 
				[<span class="citation">ControlPort</span>] must be a conjugated port.
			</p>
<p>From the outline view right click 
				[<span class="citation">BlinkyTop</span>] and select 
				[<span class="citation">Edit Structure</span>].
			</p>
<p>Drag and Drop an 
				[<span class="citation">ActorRef</span>] inside the 
				[<span class="citation">BlinkyTop</span>] actor. Name it 
				[<span class="citation">blinky</span>]. From the actor class drop down list select 
				[<span class="citation">Blinky</span>]. Do the same for 
				[<span class="citation">controller</span>]. Connect the ports via the binding tool. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky05.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Implement the Behavior">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ImplementtheBehavior"></a>Implement the Behavior</h2>
</div>
</div>
</div>
<p>The application should switch on and off the LED for 5 seconds in a 1 second interval, than stop blinking for 5 seconds and start again. To implement this behavior we will implement two FSMs. One for the 1 second interval and one for the 5 second interval. The 1 second blinking should be implemented in 
				[<span class="citation">Blinky</span>]. The 5 second interval should be implemented in 
				[<span class="citation">BlinkyController</span>]. First implement the Controller.
			</p>
<p>Right click to 
				[<span class="citation">BlinkyController</span>] and select 
				[<span class="citation">Edit Behavior</span>].
				Drag and Drop the 
				[<span class="citation">Initial Point</span>] and two 
				[<span class="citation">States</span>] into the top state. Name the states 
				[<span class="citation">on</span>] and 
				[<span class="citation">off</span>]. 
				Use the 
				[<span class="citation">Transition</span>] tool to draw transitions from 
				[<span class="citation">init</span>] to 
				[<span class="citation">off</span>] from 
				[<span class="citation">on</span>] to 
				[<span class="citation">off</span>] and from 
				[<span class="citation">off</span>] to 
				[<span class="citation">on</span>].
			</p>
<p>Open the transition dialog by double click the arrow to specify the trigger event and the action code of each transition. Note that the initial transition does not have a trigger event.</p>
<p>The dialog should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky09.PNG"></div>
<p> 
			
</p>
<p>The defined ports will be generated as a member attribute of the actor class from type of the attached protocol. So, to send e message you must state 
				[<span class="citation">port.message(p1,p2);</span>]. In this example 
				[<span class="citation">ControlPort.start()</span>] sends the 
				[<span class="citation">start</span>] message via the 
				[<span class="citation">ControlPort</span>] to the outside world. Assuming that 
				[<span class="citation">Blinky</span>] is connected to this port, the message will start the one second blinking FSM. It is the same thing with the 
				[<span class="citation">timer</span>]. The SAP is also a port and follows the same rules. So it is clear that 
				[<span class="citation">timer.Start(5000);</span>] will send the 
				[<span class="citation">Start</span>] message to the timing service. The timing service will send a 
				[<span class="citation">timeoutTick</span>] message back after 5000ms.
			</p>
<p>Within each transition the timer will be restarted and the appropriate message will be sent via the 
				[<span class="citation">ControlPort</span>]. 
			</p>
<p>The resulting state machine should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky10.PNG"></div>
<p>
			
</p>
<p>Save the diagram and inspect the 
				[<span class="citation">Blinky.room</span>] file. The 
				[<span class="citation">BlinkyController</span>] should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky11.PNG"></div>
<p> 
			
</p>
<p>Now we will implement 
				[<span class="citation">Blinky</span>]. Due to the fact that 
				[<span class="citation">Blinky</span>] interacts with the GUI class a view things must to be done in the model file.
			</p>
<p>Double click 
				[<span class="citation">Blinky</span>] in the outline view to navigate to 
				[<span class="citation">Blinky</span>] within the model file.
				Add the following code:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky12.PNG"></div>
<p> 
			
</p>
<p>
				[<span class="citation">usercode1</span>] will be generated at the beginning of the file, outside the class definition. 
				[<span class="citation">usercode2</span>] will be generated within the class definition. The code imports the GUI class and instantiates the window class. Attributes for the carLights and pedLights will be declared to easily access the lights in the state machine.
				The Operation 
				[<span class="citation">destroyUser()</span>] is a predefined operation that will be called during shutdown of the application. Within this operation, cleanup of manual coded classes can be done.
			</p>
<p>Now design the FSM of 
				[<span class="citation">Blinky</span>]. Open the behavior diagram of 
				[<span class="citation">Blinky</span>] by right clicking the 
				[<span class="citation">Blinky</span>] actor in the outline view. Create two states named 
				[<span class="citation">blinking</span>] and 
				[<span class="citation">off</span>]. Right click to 
				[<span class="citation">blinking</span>] and create a subgraph.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky13.PNG"></div>
<p>
			
</p>
<p>Create the following state machine. The trigger events between 
				[<span class="citation">on</span>] and 
				[<span class="citation">off</span>] are the 
				[<span class="citation">timeoutTick</span>] from the 
				[<span class="citation">timer</span>] port. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky14.PNG"></div>
<p>
			
</p>
<p>Create entry code for both states by right clicking the state and select 
				[<span class="citation">Edit State...</span>]
			</p>
<p>Entry code of 
				[<span class="citation">on</span>] is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Start(1000);<br>
carLights.setState(TrafficLight3.YELLOW);&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Entry code  of 
				[<span class="citation">off</span>] is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Start(1000);<br>
carLights.setState(TrafficLight3.OFF);<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Navigate to the Top level state by double clicking the 
				[<span class="citation">/blinking</span>] state. Create the following state machine:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky15.PNG"></div>
<p>
			
</p>
<p>The trigger event from 
				[<span class="citation">off</span>] to 
				[<span class="citation">blinking</span>] is the 
				[<span class="citation">start</span>] event from the 
				[<span class="citation">ControlPort</span>].The trigger event from 
				[<span class="citation">blinking</span>] to 
				[<span class="citation">off</span>] is the 
				[<span class="citation">stop</span>] event from the 
				[<span class="citation">ControlPort</span>].
			</p>
<p>Action code of the init transition is:</p>
<div class="literallayout">
<p>
<code class="code">carLights&nbsp;=&nbsp;light.getCarLights();<br>
pedLights&nbsp;=&nbsp;light.getPedLights();<br>
carLights.setState(TrafficLight3.OFF);<br>
pedLights.setState(TrafficLight2.OFF);<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Action code from 
				[<span class="citation">blinking</span>] to 
				[<span class="citation">off</span>] is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Kill();<br>
carLights.setState(TrafficLight3.OFF);&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The complete resulting model looks like this:</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;Blinky&nbsp;{<br>

<br>
	LogicalSystem&nbsp;System_Blinky&nbsp;{<br>
		SubSystemRef&nbsp;subsystem:&nbsp;SubSystem_Blinky<br>
	}<br>

<br>
	SubSystemClass&nbsp;SubSystem_Blinky&nbsp;{<br>
		ActorRef&nbsp;application:&nbsp;BlinkyTop<br>
		ActorRef&nbsp;timingService:&nbsp;room.basic.service.timing.ATimingService<br>
		LayerConnection&nbsp;ref&nbsp;application&nbsp;satisfied_by&nbsp;timingService.timer<br>
		LayerConnection&nbsp;ref&nbsp;application&nbsp;satisfied_by&nbsp;timingService.timeout<br>
	}<br>

<br>
	ActorClass&nbsp;BlinkyTop&nbsp;{<br>
		Structure&nbsp;{<br>
			ActorRef&nbsp;blinky:&nbsp;Blinky<br>
			ActorRef&nbsp;controller:&nbsp;BlinkyController<br>
			Binding&nbsp;blinky.ControlPort&nbsp;and&nbsp;controller.ControlPort<br>
		}<br>
		Behavior&nbsp;{&nbsp;}<br>
	}<br>

<br>
	ActorClass&nbsp;Blinky&nbsp;{<br>
		Interface&nbsp;{<br>
			Port&nbsp;ControlPort:&nbsp;BlinkyControlProtocoll<br>
		}<br>
		Structure&nbsp;{<br>
			usercode1{<br>
				"import&nbsp;de.protos.PedLightGUI.*;"<br>
			}<br>
			usercode2&nbsp;{<br>
				"private&nbsp;PedestrianLightWndNoTcp&nbsp;light&nbsp;=&nbsp;new&nbsp;PedestrianLightWndNoTcp();"<br>
				"private&nbsp;TrafficLight3&nbsp;carLights;"<br>
				"private&nbsp;TrafficLight2&nbsp;pedLights;"<br>
				
<br>
			}<br>
			external&nbsp;Port&nbsp;ControlPort<br>
			SAP&nbsp;timer:&nbsp;room.basic.service.timing.PTimeout<br>
		}<br>
		Behavior&nbsp;{<br>
			Operation&nbsp;destroyUser(){<br>
				"light.closeWindow();"<br>
			}<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;off&nbsp;{<br>
					action&nbsp;{<br>
						"carLights&nbsp;=&nbsp;light.getCarLights();"<br>
						"pedLights&nbsp;=&nbsp;light.getPedLights();"<br>
						"carLights.setState(TrafficLight3.OFF);"<br>
						"pedLights.setState(TrafficLight2.OFF);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr0:&nbsp;off&nbsp;-&gt;&nbsp;tp0&nbsp;of&nbsp;blinking&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;start:&nbsp;ControlPort&gt;<br>
					}<br>
				}<br>
				Transition&nbsp;tr1:&nbsp;blinking&nbsp;-&gt;&nbsp;off&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;stop:&nbsp;ControlPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Kill();"<br>
						"carLights.setState(TrafficLight3.OFF);"<br>
					}<br>
				}<br>
				State&nbsp;off<br>
				State&nbsp;blinking&nbsp;{<br>
					subgraph&nbsp;{<br>
						Transition&nbsp;tr0:&nbsp;my&nbsp;tp0&nbsp;-&gt;&nbsp;on<br>
						Transition&nbsp;tr1:&nbsp;on&nbsp;-&gt;&nbsp;off&nbsp;{<br>
							triggers&nbsp;{<br>
								&lt;timeoutTick:&nbsp;timer&gt;<br>
							}<br>
						}<br>
						Transition&nbsp;tr2:&nbsp;off&nbsp;-&gt;&nbsp;on&nbsp;{<br>
							triggers&nbsp;{<br>
								&lt;timeoutTick:&nbsp;timer&gt;<br>
							}<br>
						}<br>
						Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;on&nbsp;{&nbsp;}<br>
						EntryPoint&nbsp;tp0<br>
						State&nbsp;on&nbsp;{<br>
							entry&nbsp;{<br>
								"timer.Start(1000);"<br>
								"carLights.setState(TrafficLight3.YELLOW);"<br>
							}<br>
						}<br>
						State&nbsp;off&nbsp;{<br>
							entry&nbsp;{<br>
								"timer.Start(1000);"<br>
								"carLights.setState(TrafficLight3.OFF);"<br>
							}<br>
						}<br>
					}<br>
				}<br>
			}<br>
		}<br>
	}<br>

<br>
	ActorClass&nbsp;BlinkyController&nbsp;{<br>
		Interface&nbsp;{<br>
			conjugated&nbsp;Port&nbsp;ControlPort:&nbsp;BlinkyControlProtocoll<br>
		}<br>
		Structure&nbsp;{<br>
			external&nbsp;Port&nbsp;ControlPort<br>
			SAP&nbsp;timer:&nbsp;room.basic.service.timing.PTimeout<br>
		}<br>
		Behavior&nbsp;{<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;on&nbsp;{<br>
					action&nbsp;{<br>
						"timer.Start(5000);"<br>
						"ControlPort.start();"<br>
					}<br>
				}<br>
				Transition&nbsp;goOff:&nbsp;on&nbsp;-&gt;&nbsp;off&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"ControlPort.stop();"<br>
						"timer.Start(5000);"<br>
					}<br>
				}<br>
				Transition&nbsp;goOn:&nbsp;off&nbsp;-&gt;&nbsp;on&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer|timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"ControlPort.start();"<br>
						"timer.Start(5000);"<br>
					}<br>
				}<br>
				State&nbsp;on<br>
				State&nbsp;off<br>
			}<br>
		}<br>
	}<br>

<br>
	ProtocolClass&nbsp;BlinkyControlProtocoll&nbsp;{<br>
		incoming&nbsp;{<br>
			Message&nbsp;start()<br>
			Message&nbsp;stop()<br>
		}<br>
		outgoing&nbsp;{&nbsp;}<br>
	}<br>

<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The model is complete now. You can run and debug the model as described in getting started. Have fun.</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary2"></a>Summary</h2>
</div>
</div>
</div>
<p>Run the model and take look at the generated MSCs. Inspect the generated code to understand the runtime model of eTrice. Within this tutorial you have learned how to create a hierarchical FSM with group transitions and history transitions and you have used entry code. You are now familiar with the basic features of eTrice. The further tutorials will take this knowledge as a precondition.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;Tutorial Sending Data">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialSendingData"></a>Chapter&nbsp;5.&nbsp;Tutorial Sending Data</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope3"></a>Scope</h2>
</div>
</div>
</div>
<p>This tutorial shows how data will be sent in a eTrice model. Within the example you will create two actors (MrPing and MrPong). MrPong will simply loop back every data it received.
				MrPing will sent data and verify the result.   </p>
<p>You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>create a data class</p>
</li>
<li class="listitem">
<p>define a protocol with attached data</p>
</li>
<li class="listitem">
<p>create an actor structure</p>
</li>
<li class="listitem">
<p>create two simple state machines</p>
</li>
<li class="listitem">
<p>build and run the model</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch3"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Remember exercise 
				[<span class="citation">HelloWorld</span>].
				Create a new eTrice project and name it 
				[<span class="citation">SendingData</span>]
				Open the 
				[<span class="citation">SendingData.room</span>] file and copy the following code into the file or use content assist to create the model.
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;SendingData&nbsp;{<br>
		LogicalSystem&nbsp;SendingData_LogSystem&nbsp;{<br>
			SubSystemRef&nbsp;SendingDataAppl:SendingData_SubSystem&nbsp;<br>
		}<br>
		SubSystemClass&nbsp;SendingData_SubSystem&nbsp;{<br>
			ActorRef&nbsp;SendigDataTopRef:SendingDataTop&nbsp;<br>
		}<br>
		ActorClass&nbsp;SendingDataTop&nbsp;{<br>
		}<br>
	}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Add a data class">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Addadataclass"></a>Add a data class</h2>
</div>
</div>
</div>
<p>Position the cursor outside any class definition and right click the mouse within the editor window. From the context menu select 
				[<span class="citation">Content Assist</span>] (or Ctrl+Space).  
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData01.png"></div>
<p>
			
</p>
<p>Select 
				[<span class="citation">DataClass &ndash; data class skeleton</span>] and name it 
				[<span class="citation">DemoData</span>].
				Remove the operations and ass the following Attributes:
			</p>
<div class="literallayout">
<p>
<code class="code">	DataClass&nbsp;DemoData&nbsp;{<br>
		Attribute&nbsp;int32Val:&nbsp;int32&nbsp;=&nbsp;"4711"<br>
		Attribute&nbsp;int8Array&nbsp;[&nbsp;10&nbsp;]:&nbsp;int8&nbsp;=&nbsp;"{1,2,3,4,5,6,7,8,9,10}"<br>
		Attribute&nbsp;float64Val:&nbsp;float64&nbsp;=&nbsp;"0.0"<br>
		Attribute&nbsp;stringVal:&nbsp;string&nbsp;=&nbsp;"\"empty\""<br>
	}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Save the model and visit the outline view.
				Note that the outline view contains all data elements as defined in the model. </p>
</div>
<div class="section" title="Create a new protocol">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewprotocol2"></a>Create a new protocol</h2>
</div>
</div>
</div>
<p>With the help of 
				[<span class="citation">Content Assist</span>] create a 
				[<span class="citation">ProtocolClass</span>] and name it 
				[<span class="citation">PingPongProtocol</span>]. Create the following messages:
			</p>
<div class="literallayout">
<p>
<code class="code">ProtocolClass&nbsp;PingPongProtocol&nbsp;{<br>
					incoming&nbsp;{<br>
						Message&nbsp;ping(data:&nbsp;DemoData)<br>
						Message&nbsp;pingSimple(data:int32)<br>
					}<br>
					outgoing&nbsp;{<br>
						Message&nbsp;pong(data:&nbsp;DemoData)<br>
						Message&nbsp;pongSimple(data:int32)<br>
					}<br>
				}		<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Create MrPing and MrPong Actors">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CreateMrPingandMrPongActors"></a>Create MrPing and MrPong Actors</h2>
</div>
</div>
</div>
<p>With the help of 
				[<span class="citation">Content Assist</span>] create two new actor classes and name them 
				[<span class="citation">MrPing</span>] and 
				[<span class="citation">MrPong</span>]. The resulting model should look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;SendingData&nbsp;{<br>

<br>
	LogicalSystem&nbsp;SendingData_LogSystem&nbsp;{<br>
		SubSystemRef&nbsp;SendingDataAppl:&nbsp;SendingData_SubSystem<br>
	}<br>

<br>
	SubSystemClass&nbsp;SendingData_SubSystem&nbsp;{<br>
		ActorRef&nbsp;SendigDataTopRef:&nbsp;SendingDataTop<br>
	}<br>

<br>
	ActorClass&nbsp;SendingDataTop&nbsp;{&nbsp;}<br>

<br>
	DataClass&nbsp;DemoData&nbsp;{<br>
		Attribute&nbsp;int32Val:&nbsp;int32&nbsp;=&nbsp;"4711"<br>
		Attribute&nbsp;int8Array&nbsp;[&nbsp;10&nbsp;]:&nbsp;int8&nbsp;=&nbsp;"{1,2,3,4,5,6,7,8,9,10}"<br>
		Attribute&nbsp;float64Val:&nbsp;float64&nbsp;=&nbsp;"0.0"<br>
		Attribute&nbsp;stringVal:&nbsp;string&nbsp;=&nbsp;"\"empty\""<br>
	}<br>

<br>
	ProtocolClass&nbsp;PingPongProtocol&nbsp;{<br>
		incoming&nbsp;{<br>
			Message&nbsp;ping(data:&nbsp;DemoData)<br>
			Message&nbsp;pingSimple(data:&nbsp;int32)<br>
		}<br>
		outgoing&nbsp;{<br>
			Message&nbsp;pong(data:&nbsp;DemoData)<br>
			Message&nbsp;pongSimple(data:&nbsp;int32)<br>
		}<br>
	}<br>

<br>
	ActorClass&nbsp;MrPing&nbsp;{<br>
		Interface&nbsp;{&nbsp;}<br>
		Structure&nbsp;{&nbsp;}<br>
		Behavior&nbsp;{&nbsp;}<br>
	}<br>

<br>
	ActorClass&nbsp;MrPong&nbsp;{<br>
		Interface&nbsp;{&nbsp;}<br>
		Structure&nbsp;{&nbsp;}<br>
		Behavior&nbsp;{&nbsp;}<br>
	}<br>
}&nbsp;<br>

<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The outline view should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData03.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Define the Actors Structure and Behavior">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DefinetheActorsStructureandBehavior"></a>Define the Actors Structure and Behavior</h2>
</div>
</div>
</div>
<p>Save the model and visit the outline view. Within the outline view, right click on the 
				[<span class="citation">MrPong</span>] actor and select 
				[<span class="citation">Edit Structure</span>]. Select an 
				[<span class="citation">Interface Port</span>] from the toolbox and add it to MrPong. Name the Port 
				[<span class="citation">PingPongPort</span>] and select the 
				[<span class="citation">PingPongProtocol</span>]
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData02.png"></div>
<p>
			
</p>
<p>Do the same with MrPing but mark the port as 
				[<span class="citation">conjugated</span>]
			</p>
<div class="section" title="Define MrPongs behavior">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefineMrPongsbehavior"></a>Define MrPongs behavior</h3>
</div>
</div>
</div>
<p>Within the outline view, right click MrPong and select 
					[<span class="citation">Edit Behavior</span>]. Create the following state machine:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData04.png"></div>
<p>
				
</p>
<p>The transition dialogues should look like this:
					For 
					[<span class="citation">ping</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData05.png"></div>
<p>
				
</p>
<p>For 
					[<span class="citation">pingSimple</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData06.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Define MrPing behavior">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefineMrPingbehavior"></a>Define MrPing behavior</h3>
</div>
</div>
</div>
<p>Within the outline view double click MrPing. Navigate the cursor to the behavior of MrPing. With the help of content assist create a new operation.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData07.png"></div>
<p>
				
</p>
<p>Name the operation 
					[<span class="citation">printData</span>] and define the DemoData as a parameter.
				</p>
<p>Fill in the following code:</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;printData(d:&nbsp;DemoData)&nbsp;:&nbsp;void&nbsp;{<br>
			"System.out.printf(\"d.int32Val:&nbsp;%d\\n\",d.int32Val);"<br>
			"System.out.printf(\"d.float64Val:&nbsp;%f\\n\",d.float64Val);"<br>
			"System.out.printf(\"d.int8Array:&nbsp;\");"<br>
			"for(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&lt;d.int8Array.length;&nbsp;i++)&nbsp;{"<br>
			"System.out.printf(\"%d&nbsp;\",d.int8Array[i]);}"<br>
			"System.out.printf(\"\\nd.stringVal:&nbsp;%s\\n\",d.stringVal);"<br>
		}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>For MrPing create the following state machine:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData08.png"></div>
<p>
				
</p>
<p>The transition dialogues should look like this:</p>
<p>For 
					[<span class="citation">init</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData09.png"></div>
<p>
				
</p>
<p>For 
					[<span class="citation">wait1</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData10.png"></div>
<p>
				
</p>
<p>For 
					[<span class="citation">next</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData11.png"></div>
<p>
				
</p>
<p>For 
					[<span class="citation">wait2</span>]:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData12.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Define the top level">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Definethetoplevel"></a>Define the top level</h2>
</div>
</div>
</div>
<p>Open the Structure from SendingDataTop and add MrPing and MrPong as a reference. Connect the ports.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData13.png"></div>
<p>
			
</p>
<p>The model is finished now and the model file should look like this:</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;SendingData&nbsp;{<br>

<br>
	LogicalSystem&nbsp;SendingData_LogSystem&nbsp;{<br>
		SubSystemRef&nbsp;SendingDataAppl:&nbsp;SendingData_SubSystem<br>
	}<br>

<br>
	SubSystemClass&nbsp;SendingData_SubSystem&nbsp;{<br>
		ActorRef&nbsp;SendigDataTopRef:&nbsp;SendingDataTop<br>
	}<br>

<br>
	ActorClass&nbsp;SendingDataTop&nbsp;{<br>
		Structure&nbsp;{<br>
			ActorRef&nbsp;ref0:&nbsp;MrPing<br>
			ActorRef&nbsp;ref1:&nbsp;MrPong<br>
			Binding&nbsp;ref0.PingPongPort&nbsp;and&nbsp;ref1.PingPongPort<br>
		}<br>
		Behavior&nbsp;{&nbsp;}<br>
	}<br>

<br>
	ActorClass&nbsp;MrPing&nbsp;{<br>
		Interface&nbsp;{<br>
			conjugated&nbsp;Port&nbsp;PingPongPort:&nbsp;PingPongProtocol<br>
		}<br>
		Structure&nbsp;{<br>
			external&nbsp;Port&nbsp;PingPongPort<br>
		}<br>
		Behavior&nbsp;{<br>
						
<br>
			Operation&nbsp;printData(d:&nbsp;DemoData)&nbsp;:&nbsp;void&nbsp;{<br>
						"System.out.printf(\"d.int32Val:&nbsp;%d\\n\",d.int32Val);"<br>
						"System.out.printf(\"d.float64Val:&nbsp;%f\\n\",d.float64Val);"<br>
						"System.out.printf(\"d.int8Array:&nbsp;\");"<br>
						"for(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&lt;d.int8Array.length;&nbsp;i++)&nbsp;{"<br>
						"System.out.printf(\"%d&nbsp;\",d.int8Array[i]);}"<br>
						"System.out.printf(\"\\nd.stringVal:&nbsp;%s\\n\",d.stringVal);"<br>
					}<br>
					
<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;wait2:&nbsp;waitForPong&nbsp;-&gt;&nbsp;waitForPong&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;pong:&nbsp;PingPongPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"printData(data);"<br>
					}<br>
				}<br>
				Transition&nbsp;wait1:&nbsp;waitForPongSimple&nbsp;-&gt;&nbsp;waitForPongSimple&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;pongSimple:&nbsp;PingPongPort&nbsp;guard&nbsp;{<br>
							"data&nbsp;&lt;&nbsp;10"<br>
						}&gt;<br>
					}<br>
					action&nbsp;{<br>
						"//&nbsp;keep&nbsp;in&nbsp;mind&nbsp;that&nbsp;MrPong&nbsp;increments"<br>
						"PingPongPort.pingSimple(data);"<br>
						"System.out.printf(\"data:&nbsp;%d\\n\",data);"<br>
					}<br>
				}<br>
				Transition&nbsp;next:&nbsp;waitForPongSimple&nbsp;-&gt;&nbsp;waitForPong&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;pongSimple:&nbsp;PingPongPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"System.out.printf(\"data:&nbsp;%d\\n\",data);"<br>
						""<br>
						"DemoData&nbsp;d&nbsp;=&nbsp;new&nbsp;DemoData();"<br>
						"//&nbsp;send&nbsp;the&nbsp;default&nbsp;values"<br>
						"PingPongPort.ping(d);"<br>
						"d.int32Val=815;"<br>
						"for&nbsp;(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&lt;d.int8Array.length;i++){"<br>
						"\td.int8Array[i]=(byte)(i+100);"<br>
						"\t}"<br>
						"d.stringVal=\"some&nbsp;contents\";"<br>
						"d.float64Val=3.141234;"<br>
						"PingPongPort.ping(d);"<br>
					}<br>
				}<br>
				Transition&nbsp;init0:&nbsp;initial&nbsp;-&gt;&nbsp;waitForPongSimple&nbsp;{<br>
					action&nbsp;{<br>
						"PingPongPort.pingSimple(0);"<br>
					}<br>
				}<br>
				State&nbsp;waitForPong<br>
				State&nbsp;waitForPongSimple<br>
			}<br>
		}<br>
	}<br>

<br>
	ActorClass&nbsp;MrPong&nbsp;{<br>
		Interface&nbsp;{<br>
			Port&nbsp;PingPongPort:&nbsp;PingPongProtocol<br>
		}<br>
		Structure&nbsp;{<br>
			external&nbsp;Port&nbsp;PingPongPort<br>
		}<br>
		Behavior&nbsp;{<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;looping&nbsp;{&nbsp;}<br>
				Transition&nbsp;tr0:&nbsp;looping&nbsp;-&gt;&nbsp;looping&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;ping:&nbsp;PingPongPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"PingPongPort.pong(data);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr1:&nbsp;looping&nbsp;-&gt;&nbsp;looping&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;pingSimple:&nbsp;PingPongPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"PingPongPort.pongSimple(data+1);"<br>
					}<br>
				}<br>
				State&nbsp;looping<br>
			}<br>
		}<br>
	}<br>

<br>
	ProtocolClass&nbsp;PingPongProtocol&nbsp;{<br>
		incoming&nbsp;{<br>
			Message&nbsp;ping(data:&nbsp;DemoData)<br>
			Message&nbsp;pingSimple(data:&nbsp;int32)<br>
		}<br>
		outgoing&nbsp;{<br>
			Message&nbsp;pong(data:&nbsp;DemoData)<br>
			Message&nbsp;pongSimple(data:&nbsp;int32)<br>
		}<br>
	}<br>

<br>
	DataClass&nbsp;DemoData&nbsp;{<br>
		Attribute&nbsp;int32Val:&nbsp;int32&nbsp;=&nbsp;"4711"<br>
		Attribute&nbsp;int8Array&nbsp;[&nbsp;10&nbsp;]:&nbsp;int8&nbsp;=&nbsp;"{1,2,3,4,5,6,7,8,9,10}"<br>
		Attribute&nbsp;float64Val:&nbsp;float64&nbsp;=&nbsp;"0.0"<br>
		Attribute&nbsp;stringVal:&nbsp;string&nbsp;=&nbsp;"\"empty\""<br>
	}<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Generate and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Generateandrunthemodel"></a>Generate and run the model</h2>
</div>
</div>
</div>
<p>With the MWe2 workflow generate the code and run the model. 
				The output should look like this:</p>
<p>type &sbquo;quit&rsquo; to exit
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 1
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 2
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 3
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 4
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 5
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 6
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 7
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 8
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 9
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				data: 10
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
				d.int32Val: 4711
				d.float64Val: 0,000000
				d.int8Array: 1 2 3 4 5 6 7 8 9 10 
				d.stringVal: empty
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
				d.int32Val: 815
				d.float64Val: 3,141234
				d.int8Array: 100 101 102 103 104 105 106 107 108 109 
				d.stringVal: some contents
				/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
				quit
				echo: quit</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary3"></a>Summary</h2>
</div>
</div>
</div>
<p>Within the first loop a integer value will be incremented from 
				[<span class="citation">MrPong</span>] and sent back to 
				[<span class="citation">MrPing</span>]. Is long as the guard is true 
				[<span class="citation">MrPing</span>] sends back the value.
			</p>
<p>Within the 
				[<span class="citation">next</span>] transition, 
				[<span class="citation">MrPing</span>] creates a data class and sends the default values. Than 
				[<span class="citation">MrPing</span>] changes the values and sends the class again. At this point you should note that during the send operation, a copy of the data class will be created and sent. Otherwise it would not be possible to send the same object two times, even more it would not be possible to send a stack object at all. 
				In later versions of eTrice a additional mechanism to send references will be implemented. However, keep in mind that sending references takes the responsibility of the life cycle of the sent object to the user. It looks simple but is a very common source of failures.  
			</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;Tutorial Pedestrian Lights">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialPedestrianLights"></a>Chapter&nbsp;6.&nbsp;Tutorial Pedestrian Lights</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope4"></a>Scope</h2>
</div>
</div>
</div>
<p>The scope of this tutorial is to demonstrate how to receive model messages from outside the model. Calling methods which are not part of the model is simple and you have already done this within the blinky tutorial (this is the other way round model =&gt; external code). Receiving events from outside the model is a very common problem and a very frequently asked question. Therefore this tutorial shows how an external event (outside the model) can be received from the model.</p>
<p>This tutorial is not like hello world or blinky. Be familiar with the basic tool features is a precondition for this tutorial. The goal is to understand the mechanism not to learn the tool features.</p>
<p>The idea behind the exercise is, to control a Pedestrian crossing light. We will use the same GUI as for the blinky tutorial but now we will use the 
				[<span class="citation">REQUEST</span>] button to start a FSM, which controls the traffic lights.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky08.PNG"></div>
<p>
			
</p>
<p>The 
				[<span class="citation">REQUEST</span>] must lead to a model message which starts the activity of the lights.
			</p>
<p>There are a view possibilities to receive external events (e.g. TCP/UDP Socket, using OS messaging mechanism), but the easiest way is, to make a port usable from outside the model. To do that a view steps are necessary:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>specify the messages (within a protocol) which should be sent into the model</p>
</li>
<li class="listitem">
<p>model an actor with a port (which uses the specified protocol) and connect the port to the receiver </p>
</li>
<li class="listitem">
<p>the external code should know the port (import of the port class)</p>
</li>
<li class="listitem">
<p>the external code should provide a registration method, so that the actor is able to allow access to this port</p>
</li>
<li class="listitem">
<p>the port can be used from the external code</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Setup the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Setupthemodel"></a>Setup the model</h2>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Use the 
						[<span class="citation">New Model Wizzard</span>] to create a new eTrice project and name it 
						[<span class="citation">PedLightsController</span>].
					</p>
</li>
<li class="listitem">
<p>Copy the package 
						[<span class="citation">de.protos.PedLightGUI</span>] to your 
						[<span class="citation">src</span>] directory (see blinky tutorial).
					</p>
</li>
<li class="listitem">
<p>Uncoment line 15 (import), 36, 122 (usage) and 132-134 (registration).</p>
</li>
<li class="listitem">
<p>Copy the following model to your model file:</p>
</li>
</ul>
</div>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;PedLightsController&nbsp;{<br>

<br>
	LogicalSystem&nbsp;LogSys_PedLights&nbsp;{<br>
		SubSystemRef&nbsp;application:&nbsp;SubSys_PedLights<br>
	}<br>

<br>
	SubSystemClass&nbsp;SubSys_PedLights&nbsp;{<br>
		ActorRef&nbsp;PedLightsTopRef:&nbsp;PedLightsTop<br>
		ActorRef&nbsp;timingService:&nbsp;room.basic.service.timing.ATimingService<br>
		LayerConnection&nbsp;ref&nbsp;PedLightsTopRef&nbsp;satisfied_by&nbsp;timingService.timer<br>
		LayerConnection&nbsp;ref&nbsp;PedLightsTopRef&nbsp;satisfied_by&nbsp;timingService.timeout<br>
	}<br>

<br>
	ActorClass&nbsp;PedLightsTop&nbsp;{<br>
		Structure&nbsp;{<br>
			ActorRef&nbsp;adapter:&nbsp;GuiAdapter<br>
			ActorRef&nbsp;controller:&nbsp;Controller<br>
			Binding&nbsp;adapter.ControlPort&nbsp;and&nbsp;controller.ControlPort<br>
		}<br>
		Behavior&nbsp;{&nbsp;}<br>
	}<br>

<br>
	ActorClass&nbsp;GuiAdapter&nbsp;{<br>
		Interface&nbsp;{<br>
			conjugated&nbsp;Port&nbsp;ControlPort:&nbsp;PedControlProtocol<br>
		}<br>
		Structure&nbsp;{<br>
			usercode1&nbsp;{<br>
				"import&nbsp;PedLightGUI.*;"<br>
			}<br>
			usercode2&nbsp;{<br>
				"private&nbsp;PedestrianLightWndNoTcp&nbsp;lights&nbsp;=&nbsp;new&nbsp;PedestrianLightWndNoTcp(\"Pedestrian&nbsp;Lights\",\"&nbsp;&nbsp;external&nbsp;port&nbsp;connection&nbsp;\");"<br>
				"private&nbsp;TrafficLight3&nbsp;carLights;"<br>
				"private&nbsp;TrafficLight2&nbsp;pedLights;"<br>
			}<br>
			external&nbsp;Port&nbsp;ControlPort<br>
		}<br>
		Behavior&nbsp;{<br>
			Operation&nbsp;destroyUser()&nbsp;{<br>
				"lights.closeWindow();"<br>
			}<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;running&nbsp;{<br>
					action&nbsp;{<br>
						"carLights=lights.getCarLights();"<br>
						"pedLights=lights.getPedLights();"<br>
						"carLights.setState(TrafficLight3.OFF);"<br>
						"pedLights.setState(TrafficLight2.OFF);"<br>
						"lights.setPort(ControlPort);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr0:&nbsp;running&nbsp;-&gt;&nbsp;running&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;setCarLights:&nbsp;ControlPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"carLights.setState(state);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr1:&nbsp;running&nbsp;-&gt;&nbsp;running&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;setPedLights:&nbsp;ControlPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"pedLights.setState(state);"<br>
					}<br>
				}<br>
				State&nbsp;running<br>
			}<br>
		}<br>
	}<br>

<br>
	ActorClass&nbsp;Controller&nbsp;{<br>
		Interface&nbsp;{<br>
			Port&nbsp;ControlPort:&nbsp;PedControlProtocol<br>
		}<br>
		Structure&nbsp;{<br>
			usercode1&nbsp;{<br>
				"import&nbsp;PedLightGUI.*;"<br>
			}<br>
			external&nbsp;Port&nbsp;ControlPort<br>
			SAP&nbsp;timer:&nbsp;room.basic.service.timing.PTimeout<br>
		}<br>
		Behavior&nbsp;{<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;off&nbsp;{&nbsp;}<br>
				Transition&nbsp;tr0:&nbsp;off&nbsp;-&gt;&nbsp;carsGreen&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;start:&nbsp;ControlPort&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Start(700);"<br>
						"ControlPort.setCarLights(TrafficLight3.GREEN);"<br>
						"ControlPort.setPedLights(TrafficLight2.RED);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr1:&nbsp;carsGreen&nbsp;-&gt;&nbsp;carsYellow&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Start(700);"<br>
						"ControlPort.setCarLights(TrafficLight3.YELLOW);"<br>
						"ControlPort.setPedLights(TrafficLight2.RED);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr2:&nbsp;carsYellow&nbsp;-&gt;&nbsp;carsRed&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Start(1500);"<br>
						"ControlPort.setCarLights(TrafficLight3.RED);"<br>
						"ControlPort.setPedLights(TrafficLight2.GREEN);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr3:&nbsp;carsRed&nbsp;-&gt;&nbsp;carsYellowRed&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Start(700);"<br>
						"ControlPort.setCarLights(TrafficLight3.YELLOW_RED);"<br>
						"ControlPort.setPedLights(TrafficLight2.RED);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr4:&nbsp;carsYellowRed&nbsp;-&gt;&nbsp;carsGreen2&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"timer.Start(700);"<br>
						"ControlPort.setCarLights(TrafficLight3.GREEN);"<br>
						"ControlPort.setPedLights(TrafficLight2.RED);"<br>
					}<br>
				}<br>
				Transition&nbsp;tr5:&nbsp;carsGreen2&nbsp;-&gt;&nbsp;off&nbsp;{<br>
					triggers&nbsp;{<br>
						&lt;timeoutTick:&nbsp;timer&gt;<br>
					}<br>
					action&nbsp;{<br>
						"ControlPort.setCarLights(TrafficLight3.OFF);"<br>
						"ControlPort.setPedLights(TrafficLight2.OFF);"<br>
					}<br>
				}<br>
				State&nbsp;off<br>
				State&nbsp;carsGreen<br>
				State&nbsp;carsYellow<br>
				State&nbsp;carsRed<br>
				State&nbsp;carsYellowRed<br>
				State&nbsp;carsGreen2<br>
			}<br>
		}<br>
	}<br>

<br>
	ProtocolClass&nbsp;PedControlProtocol&nbsp;{<br>
		incoming&nbsp;{<br>
			Message&nbsp;start()<br>
		}<br>
		outgoing&nbsp;{<br>
			Message&nbsp;setCarLights(state:&nbsp;int32)<br>
			Message&nbsp;setPedLights(state:&nbsp;int32)<br>
		}<br>
	}<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Arrange the Structure and the Statemachines to understand the model </p>
</li>
</ul>
</div>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights01.PNG"></div>
<p>
				The 
				[<span class="citation">GuiAdapter</span>] represents the interface to the external code. It registers its 
				[<span class="citation">ControlPort</span>] by the external code.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights02.PNG"></div>
<p>
				Visit the initial transition to understand the registration. The actor handles the incoming messages as usual and controls the traffic lights as known from blinky. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights03.PNG"></div>
<p>
				The 
				[<span class="citation">Controller</span>] receives the 
				[<span class="citation">start</span>] message and controls the timing of the lights. Note that the 
				[<span class="citation">start</span>] message will be sent from the external code whenever the 
				[<span class="citation">REQUEST</span>] button is pressed.
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p> Visit the model and take a closer look to the following elements:</p>
</li>
</ul>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>PedControlProtocol =&gt; notice that the start message is defined as usual</p>
</li>
<li class="listitem">
<p>Initial transition of the 
						[<span class="citation">GuiAdapter</span>] =&gt; see the registration
					</p>
</li>
<li class="listitem">
<p>The 
						[<span class="citation">Controller</span>] =&gt; notice that the 
						[<span class="citation">Controller</span>] receives the external message (not the 
						[<span class="citation">GuiAdapter</span>]). The 
						[<span class="citation">GuiAdapter</span>] just provides its port and handles the incoming messages.
					</p>
</li>
<li class="listitem">
<p>Visit the hand written code =&gt; see the import statement of the protocol class and the usage of the port.</p>
</li>
</ol>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Generate and test the model</p>
</li>
<li class="listitem">
<p>Take a look at the generated MSC =&gt; notice that the start message will shown as if the 
						[<span class="citation">GuiAdapter</span>] had sent it.
					</p>
</li>
</ul>
</div>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights04.PNG"></div>
<p>
			
</p>
</div>
<div class="section" title="Why does it work and why is it save?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Whydoesitworkandwhyisitsave"></a>Why does it work and why is it save?</h2>
</div>
</div>
</div>
<p>The tutorial shows that it is generally possible to use every port from outside the model as long as the port knows its peer. This is guaranteed by describing protocol and the complete structure (especially the bindings) within the model. 
				The only remaining question is: Why is it save and does not hurt the &bdquo;run to completion&rdquo; semantic. To answer this question, take a look at the 
				[<span class="citation">MessageService.java</span>] from the runtime environment. There you will find the receive method which puts each message into the queue. 
			</p>
<div class="literallayout">
<p>
<code class="code">	@Override<br>
	public&nbsp;synchronized&nbsp;void&nbsp;receive(Message&nbsp;msg)&nbsp;{<br>
		if&nbsp;(msg!=null)&nbsp;{<br>
			messageQueue.push(msg);<br>
			notifyAll();&nbsp;//&nbsp;wake&nbsp;up&nbsp;thread&nbsp;to&nbsp;compute&nbsp;message<br>
		}<br>
	}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>This method is synchronized. That means, regardless who sends the message, the queue is secured. If we later on (e.g. for performance reasons in C/C++) distinguish between internal and external senders (same thread or not), care must be taken to use the external (secure) queue.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;ROOM Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="ROOMConcepts"></a>Chapter&nbsp;7.&nbsp;ROOM Concepts</h2>
</div>
</div>
</div>
<div class="section" title="Main Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="MainConcepts"></a>Main Concepts</h2>
</div>
</div>
</div>
<div class="section" title="ActorClass">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ActorClass"></a>ActorClass</h3>
</div>
</div>
</div>
</div>
<div class="section" title="Port">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Port"></a>Port</h3>
</div>
</div>
</div>
</div>
<div class="section" title="Protocol">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Protocol"></a>Protocol</h3>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
