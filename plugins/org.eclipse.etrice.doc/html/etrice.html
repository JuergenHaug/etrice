<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>eTrice User Guide</title>
<link href="book.css" rel="stylesheet" type="text/css">
<meta content="DocBook XSL Stylesheets V1.75.1" name="generator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="book" title="eTrice User Guide">
<div class="titlepage">
<div>
<div>
<h1 class="title">
<a name="N10001"></a>eTrice User Guide</h1>
</div>
</div>
<hr>
</div>
<div class="toc">
<p>
<b>Table of Contents</b>
</p>
<dl>
<dt>
<span class="chapter"><a href="#eTriceOverview">1. eTrice Overview</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#WhatiseTrice">What is eTrice?</a></span>
</dt>
<dt>
<span class="section"><a href="#ReductionofComplexity">Reduction of Complexity</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#IntroductiontotheROOMLanguage">2. Introduction to the ROOM Language</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#ScopeofROOM">Scope of ROOM</a></span>
</dt>
<dt>
<span class="section"><a href="#BasicConcepts">Basic Concepts</a></span>
</dt>
<dt>
<span class="section"><a href="#ExecutionModels">Execution Models</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#WorkingwiththeeTriceTutorials">3. Working with the eTrice Tutorials</a></span>
</dt>
<dt>
<span class="chapter"><a href="#SettinguptheWorkspaceforJavaProjects">4. Setting up the Workspace for Java Projects</a></span>
</dt>
<dt>
<span class="chapter"><a href="#TutorialHelloWorldforJava">5. Tutorial HelloWorld for Java</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Createastatemachine">Create a state machine</a></span>
</dt>
<dt>
<span class="section"><a href="#Buildandrunthemodel">Build and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#OpentheMessageSequenceChart">Open the Message Sequence Chart</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialBlinkyJava">6. Tutorial Blinky (Java)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope2">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch2">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Addtwoadditionalactorclasses">Add two additional actor classes</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewprotocol">Create a new protocol</a></span>
</dt>
<dt>
<span class="section"><a href="#ImporttheTimingService">Import the Timing Service</a></span>
</dt>
<dt>
<span class="section"><a href="#Finishthemodelstructure">Finish the model structure</a></span>
</dt>
<dt>
<span class="section"><a href="#ImplementtheBehavior">Implement the Behavior</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary2">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialSendingDataJava">7. Tutorial Sending Data (Java)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope3">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch3">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Addadataclass">Add a data class</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewprotocol2">Create a new protocol</a></span>
</dt>
<dt>
<span class="section"><a href="#CreateMrPingandMrPongActors">Create MrPing and MrPong Actors</a></span>
</dt>
<dt>
<span class="section"><a href="#DefineActorStructureandBehavior">Define Actor Structure and Behavior</a></span>
</dt>
<dt>
<span class="section"><a href="#Definethetoplevel">Define the top level</a></span>
</dt>
<dt>
<span class="section"><a href="#Generateandrunthemodel">Generate and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary3">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialPedestrianLightsJava">8. Tutorial Pedestrian Lights (Java)</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope4">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Setupthemodel">Setup the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Whydoesitworkandwhyisitsafe">Why does it work and why is it safe?</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#SettinguptheWorkspaceforCProjects">9. Setting up the Workspace for C Projects</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Testingtheenvironment">Testing the environment</a></span>
</dt>
<dt>
<span class="section"><a href="#BuildingtheCruntimesystem">Building the C runtime system</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialHelloWorldforC">10. Tutorial HelloWorld for C</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope5">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch4">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#CreatetheHelloWorldmodel">Create the HelloWorld model</a></span>
</dt>
<dt>
<span class="section"><a href="#CreatealaunchconfigurationtostarttheCcodegenerator">Create a launch configuration to start the C code generator</a></span>
</dt>
<dt>
<span class="section"><a href="#Generatethecode">Generate the code</a></span>
</dt>
<dt>
<span class="section"><a href="#Setuptheincludepath">Setup the include path</a></span>
</dt>
<dt>
<span class="section"><a href="#Buildandrunthemodel2">Build and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary4">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#TutorialRemoveCCommentC">11. Tutorial Remove C-Comment ( C )</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Scope6">Scope</a></span>
</dt>
<dt>
<span class="section"><a href="#Createanewmodelfromscratch5">Create a new model from scratch</a></span>
</dt>
<dt>
<span class="section"><a href="#Createyourowndatatype">Create your own data type</a></span>
</dt>
<dt>
<span class="section"><a href="#Createthemodel">Create the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Generatebuildandrunthemodel">Generate, build and run the model</a></span>
</dt>
<dt>
<span class="section"><a href="#Summary5">Summary</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#ROOMConcepts">12. ROOM Concepts</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Actors">Actors</a></span>
</dt>
<dt>
<span class="section"><a href="#Protocols">Protocols</a></span>
</dt>
<dt>
<span class="section"><a href="#Ports">Ports</a></span>
</dt>
<dt>
<span class="section"><a href="#DataClass">DataClass</a></span>
</dt>
<dt>
<span class="section"><a href="#Layering2">Layering</a></span>
</dt>
<dt>
<span class="section"><a href="#FiniteStateMachines">Finite State Machines</a></span>
</dt>
</dl>
</dd>
<dt>
<span class="chapter"><a href="#eTriceDevelopersReference">13. eTrice Developer&rsquo;s Reference</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="section"><a href="#Architecture">Architecture</a></span>
</dt>
<dt>
<span class="section"><a href="#ComponentOverview">Component Overview</a></span>
</dt>
</dl>
</dd>
</dl>
</div>
 
<div class="chapter" title="Chapter&nbsp;1.&nbsp;eTrice Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="eTriceOverview"></a>Chapter&nbsp;1.&nbsp;eTrice Overview</h2>
</div>
</div>
</div>
<div class="section" title="What is eTrice?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="WhatiseTrice"></a>What is eTrice?</h2>
</div>
</div>
</div>
<p>eTrice provides an implementation of the ROOM modeling language (Real Time Object Oriented Modeling) together with editors, code generators for Java, C++ and C code and exemplary target middleware.</p>
<p>The model is defined in textual form (Xtext) with graphical editors (Graphiti) for the structural and behavioral (i.e. state machine) parts.  </p>
</div>
<div class="section" title="Reduction of Complexity">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ReductionofComplexity"></a>Reduction of Complexity</h2>
</div>
</div>
</div>
<p>eTrice is all about the reduction of complexity:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>structural complexity</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>by explicit modeling of hierarchical Actor containment, layering and inheritance</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>behavioral complexity</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>by hierachical statemachines with inheritance</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>teamwork complexity</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>because loosely coupled Actors provide a natural way to structure team work</p>
</li>
<li class="listitem">
<p>since textual model notation allows simple branching and merging</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>complexity of concurrent &amp; distributed systems</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>because loosely coupled Actors are deployable to threads, processes, nodes</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>complexity of variant handling and reuse (e.g. for product lines)</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>by composition of existing Actors to new structures</p>
</li>
<li class="listitem">
<p>since Protocols and Ports make Actors replaceable</p>
</li>
<li class="listitem">
<p>by inheritance for structure, behavior and Protocols</p>
</li>
<li class="listitem">
<p>by making use of model level libraries</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>complexity of debugging</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>model level debugging: state machine animation, data inspection and manipulation, message injection, generated message sequence charts</p>
</li>
<li class="listitem">
<p>model checking easier for model than for code (detect errors before they occur)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;2.&nbsp;Introduction to the ROOM Language">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="IntroductiontotheROOMLanguage"></a>Chapter&nbsp;2.&nbsp;Introduction to the ROOM Language</h2>
</div>
</div>
</div>
<div class="section" title="Scope of ROOM">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ScopeofROOM"></a>Scope of ROOM</h2>
</div>
</div>
</div>
<p>This chapter will give a rough overview of what ROOM (
				<span class="bold"><strong>R</strong></span> eal time 
				<span class="bold"><strong>O</strong></span> bject 
				<span class="bold"><strong>O</strong></span> riented 
				<span class="bold"><strong>M</strong></span> odeling) is and what it is good for. It will try to answer the following questions:
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Where does it come from?</p>
</li>
<li class="listitem">
<p>Which kind of SW-Systems will be addressed?</p>
</li>
<li class="listitem">
<p>What is the relation between OOP and ROOM?</p>
</li>
<li class="listitem">
<p>What are the benefits of ROOM?</p>
</li>
<li class="listitem">
<p>Which consequences must be taken into account?</p>
</li>
</ul>
</div>
<div class="section" title="Where does it come from?">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Wheredoesitcomefrom"></a>Where does it come from?</h3>
</div>
</div>
</div>
<p>Room was developed in the 1990th on the background of the upcoming mobile applications with the goal to manage the complexity of such huge SW-Systems. From the very beginning ROOM has focused on a certain type of SW-Systems and is, in contrast to the UML, well suited for this kind of systems. In this sense, ROOM is a DSL (Domain Specific Language) for distributed, event driven, real time systems. </p>
<p>Bran Selic, Garth Gullekson and Paul T. Ward have published the concepts 1994 in the book 
					<span class="bold"><strong>Real-Time Object-Oriented Modeling</strong></span>. The company 
					<span class="emphasis"><em>object time</em></span> &trade; developed a ROOM tool which was taken over by 
					<span class="emphasis"><em>Rational SW</em></span> &trade; and later on by 
					<span class="emphasis"><em>IBM</em></span> &trade;. 
					The company 
					<span class="emphasis"><em>Protos Software Gmbh</em></span> &trade; also developed a ROOM tool called 
					<span class="emphasis"><em>Trice</em></span> &trade; for control software for production machines and automotive systems. 
					<span class="emphasis"><em>Trice</em></span> &trade; is the predecessor of eTrice (see Introduction to eTrice). 
				</p>
<p>From our point of view ROOM provides still the clearest, simplest, most complete and best suited modeling concepts for the real time domain. All later proposals like the UML do not fit as well to this kind of problems.</p>
</div>
<div class="section" title="Which kind of SW-Systems will be addressed?">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="WhichkindofSWSystemswillbeaddressed"></a>Which kind of SW-Systems will be addressed?</h3>
</div>
</div>
</div>
<p>As mentioned before ROOM addresses distributed, event driven, real time systems. But what is a 
					<span class="bold"><strong>real time system</strong></span>? ROOM defines a set of properties which are typical for a real time system. These properties are:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Timeliness</p>
</li>
<li class="listitem">
<p>Dynamic internal structure</p>
</li>
<li class="listitem">
<p>Reactiveness</p>
</li>
<li class="listitem">
<p>Concurrency</p>
</li>
<li class="listitem">
<p>Distribution</p>
</li>
<li class="listitem">
<p>Reliability</p>
</li>
</ul>
</div>
<p>Each of these properties has potential to make SW development complex. If a given system can be characterized with a combination of or all of these properties, ROOM might be applied to such a system.  </p>
<p>As an example take a look at a washing machine. The system has to react on user interactions, has to handle some error conditions like a closed water tap or a defective lye pump. It has to react simultaneously to all these inputs. It has to close the water valve in a certain time to avoid flooding the basement. 
					So, the system can be characterized as timely, concurrent and reactive. As long as the washing machine does not transform to a laundry drier by itself, the system has no dynamic internal structure and as long as all functions are running on a single micro controller the (SW)-system is not distributed. 
					ROOM fits perfect to such a system.</p>
<p>A SW system which mainly consists of data transformations like signal/image processing or a loop controller (e.g. a PID controller) cannot be characterized with any of the above mentioned properties. However, in the real world most of the SW systems will be a combination of both. ROOM can be combined with such systems, so that for example an actor provides a 
					<span class="bold"><strong>run to completion</strong></span> context for calculating an image processing algorithm or a PID controller.  
				</p>
</div>
<div class="section" title="What is the relation between OOP and ROOM?">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="WhatistherelationbetweenOOPandROOM"></a>What is the relation between OOP and ROOM?</h3>
</div>
</div>
</div>
<p>The relation between classical object oriented programming and ROOM is comparable to the relation between assembler programming and C programming. It provides a shift of the object paradigm. As the picture shows, the classic object paradigm provides some kind of information hiding. Attributes can be accessed via access methods. Logical higher level methods provide the requested behavior to the user.   </p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/010-RoomIntroduction01.png"></div>
<p>
				
</p>
<p>As the figure illustrates, the classical object paradigm does not care about concurrency issues. The threads of control will be provided by the underlying operating system and the user is responsible to avoid access violations by using those operating system mechanisms directly (semaphore, mutex).</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/010-RoomIntroduction02.png"></div>
<p>
				
</p>
<p>ROOM provides the concept of a logical machine (called actor) with its own thread of control. It provides some kind of cooperative communication infrastructure with 
					<span class="bold"><strong>run to completion</strong></span> semantic. That makes developing of business logic easy and safe (see basic concepts). The logical machine provides an encapsulation shell including concurrency issues (see chapter 
					<span class="bold"><strong>Run to completion</strong></span>). 
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/010-RoomIntroduction03.png"></div>
<p>
				
</p>
<p>This thinking of an object is much more general than the classic one.  </p>
</div>
<div class="section" title="What are the benefits of ROOM?">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="WhatarethebenefitsofROOM"></a>What are the benefits of ROOM?</h3>
</div>
</div>
</div>
<p>ROOM has a lot of benefits and it depends on the users point of view which is the most important one. From a general point of view the most important benefit is, that ROOM allows to create SW systems very efficient, robust and safe due to the fact that it provides some abstract, high level modeling concepts combined with code generation and a small efficient runtime environment.  </p>
<p>In detail:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>ROOM models contain well defined interfaces (protocols), which makes it easy to reuse components in different applications or e.g. in a test harness. </p>
</li>
<li class="listitem">
<p>Graphical modeling makes it easy to understand, maintain and share code with other developers</p>
</li>
<li class="listitem">
<p>Higher abstraction in combination with automated code generation provides very efficient mechanisms to the developer. </p>
</li>
<li class="listitem">
<p>ROOM provides graphical model execution, which makes it easy to understand the application or find defects in a very early phase. </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Which consequences must be taken into account?">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Whichconsequencesmustbetakenintoaccount"></a>Which consequences must be taken into account?</h3>
</div>
</div>
</div>
<p>Generating code from models will introduce some overhead in terms of memory footprint as well as performance. For most systems the overhead will be negligible. However, the decision for using ROOM should be made explicitly and it is always a trade off between development costs, time to market and costs in terms of a little bit more of memory and performance. Thanks to the powerful component model, ROOM is especially well suited for the development of software product lines with their need for reusable core assets.  </p>
<p>Care must be taken during the introduction of the new methodology. Due to the fact that ROOM provides a shift of the object paradigm, developers and teams need a phase of adaption. Every benefit comes at a price.</p>
</div>
</div>
<div class="section" title="Basic Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="BasicConcepts"></a>Basic Concepts</h2>
</div>
</div>
</div>
<div class="section" title="Actor, Port, Protocol">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ActorPortProtocol"></a>Actor, Port, Protocol</h3>
</div>
</div>
</div>
<p>The basic elements of ROOM are the actors with their ports and protocols. The protocol provides a formal interface description. The port is an interaction point where the actor interacts with its outside world. Each port has exactly one protocol attached. The sum of all ports builds up the complete interface of an actor. Each port can receive messages, with or without data, which are defined in the attached protocol. Each message will be handled by the actors behavior (state machine) or will be delegated to the actors internal structure.</p>
<table title="Actor and Protocol Example" id="N10113">
<tr>
							
<td>
					
<div class="mediaobject">
<img src="images/040-ActorClass.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-ProtocolClassTextualNotation.png"></div>
</td>
						
</tr>
<tr>
							
<td align="center">
					<span class="bold"><strong>Actor with Subactors</strong></span></td>
							<td align="center">
					<span class="bold"><strong>Protocol Definition</strong></span></td>
						
</tr>
</table>
<p>
				
</p>
<p>The actor provides access protection for its own attributes (including complex types (classical objects)), including concurrency protection. An actor has neither public attributes nor public operations. The only interaction with the outside world takes place via interface ports. This ensures a high degree of reusability on actor level and provides an effective and safe programming model to the developer. </p>
<p>Receiving a message via a port will trigger the internal state machine. A transition will be executed depending on the message and the current state. Within this transition, detail level code will be executed and response messages can be sent.</p>
<p>
					
<a class="ulink" href="http://eclipse.org/etrice/images/010-room-introduction01.avi" target="_new">video: receiving a message</a>
				
</p>
<p>With this model, a complex behavior can be divided into many relatively simple, linked actors. To put it the other way round: The complex behavior will be provided by a network of relatively simple components which are communicating with each other via well defined interfaces.</p>
</div>
<div class="section" title="Hierarchy in Structure and Behavior">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="HierarchyinStructureandBehavior"></a>Hierarchy in Structure and Behavior</h3>
</div>
</div>
</div>
<p>ROOM provides two types of hierarchy. Behavioral hierarchy and structural hierarchy. Structural hierarchy means that actors can be nested to arbitrary depth. Usually you will add more and more details to your application with each nesting level. That means you can focus yourself on any level of abstraction with always the same element, the actor. Structural hierarchy provides a powerful mechanism to divide your problem in smaller pieces, so that you can focus on the level of abstraction you want to work on. </p>
<p>The actor&rsquo;s behavior will be described with a state machine. A state in turn may contain sub states. This is another possibility to focus on an abstraction level. Take the simple FSM from the blinky actor from the blinky tutorial. </p>
<p>Top level:

					</p>
<div class="mediaobject">
<img src="images/020-Blinky15.png"></div>
<p>
				
</p>
<p>
					
<span class="emphasis"><em>blinking</em></span> Sub machine:

					</p>
<div class="mediaobject">
<img src="images/020-Blinky151.png"></div>
<p>
				
</p>
<p>From an abstract point of view there is a state 
					<span class="emphasis"><em>blinking</em></span>. But a simple LED is not able to blink autonomously. Therefore you have to add more details to your model to make a LED blinking, but for the current work it is not of interest how the blinking is realized. This will be done in the next lower level of the hierarchy. 
				</p>
<p>This simple example might give an idea how powerful this mechanisms is.</p>
<p>The hierarchical FSM provides a rich tool box to describe real world problems (see 
					<span class="bold"><strong>room concepts</strong></span>).
				</p>
</div>
<div class="section" title="Layering">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Layering"></a>Layering</h3>
</div>
</div>
</div>
<p>Layering is another well known form of abstraction to reduce complexity in the structure of systems. ROOM is probably the only language that supports Layering directly as language feature.
					Layering can be expressed in ROOM by Actors with specialized Ports, called Service Access Points (
					<span class="bold"><strong>SAP</strong></span>) and Service Provision Points (
					<span class="bold"><strong>SPP</strong></span>).
				</p>
<p>The Actor that provides a service implements an SPP and the client of that service implements an SAP. The Layer Connection connects all SAPs of a specific Protocol within an Actor hierarchy with an SPP that implements the service. From the Actors point of view, SAPs and SPPs behave almost like regular ports.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/010-LayerExample.png"></div>
<p>
				
</p>
<p>The Example shows a layered model. The Layer Connections define e.g. that the 
					<span class="emphasis"><em>ApplicationLayer</em></span> can only use the services of the 
					<span class="emphasis"><em>ServiceLayer</em></span> and the 
					<span class="emphasis"><em>CommunicationLayer</em></span>. Actors inside the 
					<span class="emphasis"><em>ApplicationLayer</em></span> that implement an SAP for those services are connected directly to the implementation of the services. 
					Layering and actor hierarchies with port to port connections can be mixed on every level of granularity. 
				</p>
</div>
<div class="section" title="Run to Completion">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RuntoCompletion"></a>Run to Completion</h3>
</div>
</div>
</div>
<p>
					
<span class="bold"><strong>Run to completion</strong></span> (RTC) is a very central concept of ROOM. It enables the developer to concentrate on the functional aspects of the system. The developer doesn&rsquo;t have to care about concurrency issues all the time. This job is concentrated to the system designer in a very flexible way.
					What does 
					<span class="bold"><strong>run to completion</strong></span> mean:
					RTC means that an actor, which is processing a message, can not receive the next message as long as the processing of the current message has been finished. Receiving of the next message will be queued from the underlying run time system.
				</p>
<p>Note: It is very important not to confuse run to completion and preemption. Run to completion means that an actor will finish the processing of a message before he can receive a new one (regardless of its priority). That does not mean that an actor cannot be preempted from an higher priority thread of control. But even a message from this higher prior thread of control will be queued until the current processing has been finished. </p>
<p>With this mechanism all actor internal attributes and data structures are protected. Due to the fact that multiple actors share one thread of control, all objects are protected which are accessed from one thread of control but multiple actors. This provides the possibility to decompose complex functionality to several actors without the risk to produce access violations or dead locks.</p>
</div>
</div>
<div class="section" title="Execution Models">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ExecutionModels"></a>Execution Models</h2>
</div>
</div>
</div>
<p>Since from ROOM models executable code can be generated, it is important to define the way the actors are executed and communicate with each other. The combination of communication and execution is called the Execution Model.
				Currently the eTrice tooling only supports the 
				<span class="bold"><strong>message driven</strong></span> and parts of the 
				<span class="bold"><strong>data driven</strong></span> execution model. In future releases more execution models will be supported, depending on the requirements of the community.
			</p>
<div class="section" title="Communication Methods">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="CommunicationMethods"></a>Communication Methods</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<span class="bold"><strong>message driven</strong></span> (asynchronous, non blocking, no return value): Usually the message driven communication is implemented with message queues. Message queues are inherently asynchronous and enable a very good decoupling of the communicating parties.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="bold"><strong>data driven</strong></span> (asynchronous, non blocking, no return value): In data driven communication sender and receiver often have a shared block of data. The sender writes the data and the receiver polls the data.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="bold"><strong>function call</strong></span> (synchronous, blocking, return value): Regular function call as known in most programming languages.
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Execution Methods">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ExecutionMethods"></a>Execution Methods</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
							
<span class="bold"><strong>execution by receive event</strong></span>: The message queue or the event dispatcher calls a 
							<span class="bold"><strong>receive event</strong></span> function of the message receiver an thereby executes the processing of the event.
						</p>
</li>
<li class="listitem">
<p>
							
<span class="bold"><strong>polled execution</strong></span>: The objects are processed by a cyclic 
							<span class="bold"><strong>execute</strong></span> call
						</p>
</li>
<li class="listitem">
<p>
							
<span class="bold"><strong>execution by function call</strong></span>: The caller executes the called object via function call
						</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Execution Models">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ExecutionModels2"></a>Execution Models</h3>
</div>
</div>
</div>
<p>In todays embedded systems in most cases one or several of the following execution models are used:</p>
<div class="section" title="message driven">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="messagedriven"></a>message driven</h4>
</div>
</div>
</div>
<p>The message driven execution model is a combination of message driven communication and execution by receive event.
						This model allows for distributed systems with a very high throughput.
						It can be deterministic but the determinism is hard to proof.
						This execution model is often found in telecommunication systems and high performance automation control systems.</p>
</div>
<div class="section" title="data driven">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="datadriven"></a>data driven</h4>
</div>
</div>
</div>
<p>The data driven execution model is a combination of data driven communication and polled execution.
						This model is highly deterministic and very robust, but the polling creates a huge performance overhead.
						The determinism is easy to proof (simple mathematics). 
						The execution model is also compatible with the execution model of control software generated by Tools like Matlab&trade; and LabView&trade;.
						This model is usually used for systems with requirements for safety, such as automotive and avionic systems.</p>
</div>
<div class="section" title="synchronous">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="synchronous"></a>synchronous</h4>
</div>
</div>
</div>
<p>The synchronous execution model could also be called 
						<span class="bold"><strong>simple function calls</strong></span>. 
						This model is in general not very well suited to support the 
						<span class="bold"><strong>run to completion</strong></span> semantic typical for ROOM models, but could also be generated from ROOM models. 
						With this execution model also lower levels of a software system, such as device drivers, could be generated from ROOM models.
					</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;3.&nbsp;Working with the eTrice Tutorials">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="WorkingwiththeeTriceTutorials"></a>Chapter&nbsp;3.&nbsp;Working with the eTrice Tutorials</h2>
</div>
</div>
</div>
<p>The eTrice Tutorials will help you to learn and understand the eTrice tool and concepts. ETrice supports several target languages. The concepts will not be explained for each language. </p>
<p>Most of the common concepts will be described for Java as target language. To start with a new language the first steps to setup the workspace and to generate and run the first model will be described also. Target language specific aspects will be described as well.</p>
<p>Therefore the best way to start with eTrice is to follow the Java Tutorials and after that switch to your target language.  </p>
</div>
<div class="chapter" title="Chapter&nbsp;4.&nbsp;Setting up the Workspace for Java Projects">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="SettinguptheWorkspaceforJavaProjects"></a>Chapter&nbsp;4.&nbsp;Setting up the Workspace for Java Projects</h2>
</div>
</div>
</div>
<p>ETrice generates code out of ROOM models. The code generator and the generated code relies on a runtime framework and on some ready to use model parts. This parts provide services like:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>messaging</p>
</li>
<li class="listitem">
<p>logging</p>
</li>
<li class="listitem">
<p>timing</p>
</li>
</ul>
</div>
<p>Additionally some tutorial models will be provided to make it easy to start with eTrice. All this parts must be available in our workspace before you can start working. After installation of eclipse (juno) and the eTrice plug in, your workspace should look like this:  </p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace01.png"></div>
<p>
		
</p>
<p>Just the 
			<span class="emphasis"><em>eTrice</em></span> menu item is visible from the eTrice tool.
			From the 
			<span class="emphasis"><em>File</em></span> menu select 
			<span class="emphasis"><em>File-&gt;New-&gt;Project</em></span>
		
</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace02.png"></div>
<p>
		
</p>
<p>Open the 
			<span class="emphasis"><em>eTrice</em></span> tab and select 
			<span class="emphasis"><em>eTrice Java Runtime</em></span>
		
</p>
<p>Press 
			<span class="emphasis"><em>Next</em></span> and 
			<span class="emphasis"><em>Finish</em></span> to install the Runtime into your workspace.
		</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace03.png"></div>
<p>
		
</p>
<p>Do the same steps for 
			<span class="emphasis"><em>eTrice Java Modellib</em></span> and 
			<span class="emphasis"><em>eTrice Java Tutorials</em></span>. To avoid temporary error markers you should keep the proposed order of installation. The resulting workspace should look like this:
		</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace04.png"></div>
<p>
		
</p>
<p>Now workspace is set up and you can perform the tutorials or start with your work.</p>
<p>The tutorial models are available in the 
			<span class="emphasis"><em>org.eclipse.etrice.tutorials</em></span> project. All tutorials are ready to generate and run without any changes. To start the code generator simply run 
			<span class="bold"><strong>gen_org.eclipse.etrice.tutorials.launch</strong></span> as 
			<span class="bold"><strong>gen_org.eclipse.etrice.tutorials.launch</strong></span>: 
		</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace05.png"></div>
<p>
		
</p>
<p>After generation for each tutorial a java file called 
			<span class="bold"><strong>SubSystem_ModelnameRunner.java</strong></span> is generated. To run the model simply run this file as a java application:
		</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace06.png"></div>
<p>
		
</p>
<p>To stop the application type 
			<span class="emphasis"><em>quit</em></span> in the console window.
		</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/013-SetupWorkspace07.png"></div>
<p>
		
</p>
<p>Performing the tutorials will setup an dedicated project for each tutorial. Therefore there are some slight changes especially whenever a path must be set (e.g. to the model library) within your own projects. All this is described in the tutorials.</p>
</div>
<div class="chapter" title="Chapter&nbsp;5.&nbsp;Tutorial HelloWorld for Java">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialHelloWorldforJava"></a>Chapter&nbsp;5.&nbsp;Tutorial HelloWorld for Java</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope"></a>Scope</h2>
</div>
</div>
</div>
<p>In this tutorial you will build your first very simple eTrice model. The goal is to learn the work flow of eTrice and to understand a few basic features of ROOM. You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>add a very simple state machine to an actor</p>
</li>
<li class="listitem">
<p>generate the source code</p>
</li>
<li class="listitem">
<p>run the model</p>
</li>
<li class="listitem">
<p>open the message sequence chart</p>
</li>
</ol>
</div>
<p>Make sure that you have set up the workspace as described in 
				<span class="emphasis"><em>Setting up the workspace</em></span>.
			</p>
<p>
				
<a class="ulink" href="http://eclipse.org/etrice/images/015-HelloWorld01.avi" target="_new">video hello world</a>
			
</p>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>The easiest way to create a new eTrice Project is to use the eclipse project wizard. From the eclipse file menu select 
				<span class="emphasis"><em>File-&gt;New-&gt;Project</em></span> and create a new eTrice project and name it 
				<span class="emphasis"><em>HelloWorld</em></span>
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld10.png"></div>
<p>
			
</p>
<p>The wizard creates everything that is needed to create, build and run an eTrice model. The resulting project should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld11.png"></div>
<p>
			
</p>
<p>Within the model directory the model file 
				<span class="emphasis"><em>HelloWorld.room</em></span> was created. Open the 
				<span class="emphasis"><em>HelloWorld.room</em></span> file and delete the contents of the file. Open the content assist with Ctrl+Space and select 
				<span class="emphasis"><em>model skeleton</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld12.png"></div>
<p>   
			
</p>
<p>Edit the template variables by typing the new names and jumping with Tab from name to name.</p>
<p>The resulting model code should look like this:</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;HelloWorld&nbsp;{<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;LogicalSystem&nbsp;System_HelloWorld&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubSystemRef&nbsp;subsystem&nbsp;:&nbsp;SubSystem_HelloWorld<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;SubSystemClass&nbsp;SubSystem_HelloWorld&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActorRef&nbsp;application&nbsp;:&nbsp;HelloWorldTop<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;HelloWorldTop&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The goal of eTrice is to describe distributed systems on a logical level. In the current version not all elements will be used. But as prerequisite for further versions the following elements can be defined:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>the 
						<span class="emphasis"><em>LogicalSystem</em></span> (currently optional)
					</p>
</li>
<li class="listitem">
<p>at least one 
						<span class="emphasis"><em>SubSystemClass</em></span> (mandatory)
					</p>
</li>
<li class="listitem">
<p>at least one 
						<span class="emphasis"><em>ActorClass</em></span> (mandatory)
					</p>
</li>
</ul>
</div>
<p>The 
				<span class="emphasis"><em>LogicalSystem</em></span> represents the complete distributed system and contains at least one 
				<span class="emphasis"><em>SubSystemRef</em></span>. The 
				<span class="emphasis"><em>SubSystemClass</em></span> represents an address space and contains at least one 
				<span class="emphasis"><em>ActorRef</em></span>. The 
				<span class="emphasis"><em>ActorClass</em></span> is the building block of which an application will be built of. It is in general a good idea to define a top level actor that can be used as reference within the subsystem.
			</p>
<p>The outline view of the textual ROOM editor shows the main modeling elements in an easy to navigate tree.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld02.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Create a state machine">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createastatemachine"></a>Create a state machine</h2>
</div>
</div>
</div>
<p>We will implement the Hello World code on the initial transition of the 
				<span class="emphasis"><em>HelloWorldTop</em></span> actor. Therefore open the state machine editor by right clicking the 
				<span class="emphasis"><em>HelloWorldTop</em></span> actor in the outline view and select 
				<span class="emphasis"><em>Edit Behavior</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld03.png"></div>
<p>
			
</p>
<p>The state machine editor will be opened. Drag and drop an 
				<span class="emphasis"><em>Initial Point</em></span> from the tool box to the diagram into the top level state. Drag and drop a 
				<span class="emphasis"><em>State</em></span> from the tool box to the diagram. Confirm the dialogue with 
				<span class="emphasis"><em>ok</em></span>. Select the 
				<span class="emphasis"><em>Transition</em></span> in the tool box and draw the transition from the 
				<span class="emphasis"><em>Initial Point</em></span> to the State. Open the transition dialogue by double clicking the transition arrow and fill in the action code.
			</p>
<div class="literallayout">
<p>
<code class="code">System.out.println("Hello&nbsp;World&nbsp;!");<br>

</code>
</p>
</div>
<p>The result should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld04.png"></div>
<p>
			
</p>
<p>Save the diagram and inspect the model file. Note that the textual representation was created after saving the diagram.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld05.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Build and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Buildandrunthemodel"></a>Build and run the model</h2>
</div>
</div>
</div>
<p>Now the model is finished and source code can be generated. The project wizard has created a launch configuration that is responsible for generating the source code. From 
				<span class="emphasis"><em>HelloWorld/</em></span> right click 
				<span class="bold"><strong>gen_HelloWorld.launch</strong></span> and run it as gen_HelloWorld. All model files in the model directory will be generated.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld06.png"></div>
<p>
			
</p>
<p>The code will be generated to the src-gen directory. The main function will be contained in 
				<span class="bold"><strong>SubSystem_HelloWorldRunner.java</strong></span>. Select this file and run it as Java application.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld07.png"></div>
<p>
			
</p>
<p>The Hello World application starts and the string will be printed on the console window. To stop the application the user must type 
				<span class="emphasis"><em>quit</em></span> in the console window.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld08.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Open the Message Sequence Chart">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="OpentheMessageSequenceChart"></a>Open the Message Sequence Chart</h2>
</div>
</div>
</div>
<p>During runtime the application produced a MSC and wrote it to a file. Open HelloWorld/tmp/log/SubSystem_HelloWorld_Async.seq using Trace2UML (it is open source and can be obtained from  http://trace2uml.tigris.org/). You should see something like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/015-HelloWorld09.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary"></a>Summary</h2>
</div>
</div>
</div>
<p>Now you have generated your first eTrice model from scratch. You can switch between diagram editor and model (.room file) and you can see what will be generated during editing and saving the diagram files. 
				You should take a look at the generated source files to understand how the state machine is generated and the life cycle of the application. The next tutorials will deal with more complex hierarchies in structure and behavior.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;6.&nbsp;Tutorial Blinky (Java)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialBlinkyJava"></a>Chapter&nbsp;6.&nbsp;Tutorial Blinky (Java)</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope2"></a>Scope</h2>
</div>
</div>
</div>
<p>This tutorial describes how to use the 
				<span class="emphasis"><em>TimingService</em></span>, how to combine a generated model with manual code and how to model a hierarchical state machine. The idea of the tutorial is to switch a LED on and off. The behavior of the LED should be: blinking in a one second interval for 5 seconds, stop blinking for 5 seconds, blinking, stop,...  
				For this exercise we will use a little GUI class that will be used in more sophisticated tutorials too. The GUI simulates a pedestrian traffic crossing. For now, just a simple LED simulation will be used from the GUI. 
			</p>
<p>After the exercise is created you must copy the GUI to your src directory (see below).</p>
<p>The package contains four java classes which implements a small window with a 3-light traffic light which simulates the signals for the car traffic and a 2-light traffic light which simulates the pedestrian signals.</p>
<p>The GUI looks like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky08.png"></div>
<p>
			
</p>
<p>Within this tutorial we will just toggle the yellow light.</p>
<p>You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>define a protocol</p>
</li>
<li class="listitem">
<p>create an actor structure</p>
</li>
<li class="listitem">
<p>create a hierarchical state machine</p>
</li>
<li class="listitem">
<p>use the predefined 
						<span class="emphasis"><em>TimingService</em></span>
					
</p>
</li>
<li class="listitem">
<p>combine manual code with generated code</p>
</li>
<li class="listitem">
<p>build and run the model</p>
</li>
<li class="listitem">
<p>open the message sequence chart</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch2"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Remember the exercise 
				<span class="emphasis"><em>HelloWorld</em></span>.
				Create a new eTrice project and name it 
				<span class="emphasis"><em>Blinky</em></span>
			
</p>
<p>To use the GUI please copy the package 
				<span class="emphasis"><em>org.eclipse.etrice.tutorials.PedLightGUI</em></span> from 
				<span class="emphasis"><em>org.eclipse.etrice.tutorials/src</em></span> to your 
				<span class="bold"><strong>src</strong></span> directory 
				<span class="emphasis"><em>Blinky/src</em></span>. For this tutorial you must remove the error markers by editing the file 
				<span class="emphasis"><em>PedestrianLightWndNoTcp.java</em></span>. Appropriate comments are provided to remove the error markers for this turorial.
			</p>
<p>Open the 
				<span class="emphasis"><em>Blinky.room</em></span> file and copy the following code into the file or use content assist to create the model.
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;Blinky&nbsp;{<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;LogicalSystem&nbsp;System_Blinky&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubSystemRef&nbsp;subsystem&nbsp;:&nbsp;SubSystem_Blinky<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;SubSystemClass&nbsp;SubSystem_Blinky&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActorRef&nbsp;application&nbsp;:&nbsp;BlinkyTop<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;BlinkyTop&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Add two additional actor classes">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Addtwoadditionalactorclasses"></a>Add two additional actor classes</h2>
</div>
</div>
</div>
<p>Position the cursor outside any class definition and right click the mouse within the editor window. From the context menu select 
				<span class="emphasis"><em>Content Assist</em></span>  
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky02.png"></div>
<p>
			
</p>
<p>Select 
				<span class="emphasis"><em>ActorClass &ndash; actor class skeleton</em></span> and name it 
				<span class="emphasis"><em>Blinky</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky01.png"></div>
<p> 
			
</p>
<p>Repeat the described procedure and name the new actor 
				<span class="emphasis"><em>BlinkyController</em></span>.
			</p>
<p>With Ctrl+Shift+F you can beautify the model code. </p>
<p>Save the model and visit the outline view.</p>
</div>
<div class="section" title="Create a new protocol">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewprotocol"></a>Create a new protocol</h2>
</div>
</div>
</div>
<p>With the help of 
				<span class="emphasis"><em>Content Assist</em></span> create a 
				<span class="emphasis"><em>ProtocolClass</em></span> and name it 
				<span class="emphasis"><em>BlinkyControlProtocol</em></span>.
				Inside the brackets use the 
				<span class="emphasis"><em>Content Assist</em></span> (CTRL+Space) to create two incoming messages called 
				<span class="emphasis"><em>start</em></span> and 
				<span class="emphasis"><em>stop</em></span>.
			</p>
<p>The resulting code should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky03.png"></div>
<p> 
			
</p>
<p>With Ctrl-Shift+F or selecting 
				<span class="emphasis"><em>Format</em></span> from the context menu you can format the text. Note that all elements are displayed in the outline view.
			</p>
</div>
<div class="section" title="Import the Timing Service">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ImporttheTimingService"></a>Import the Timing Service</h2>
</div>
</div>
</div>
<p>Switching on and off the LED is timing controlled. The timing service is provided from the model library and must be imported before it can be used from the model.</p>
<p>This is the first time you use an element from the modellib. Make sure that your Java Build Path has the appropriate entry to the modellib. Otherwise the jave code, which will be generated from the modellib, can not be referenced.
				(right click to 
				<span class="emphasis"><em>Blinky</em></span> and select properties. Select the 
				<span class="emphasis"><em>Java Build Path</em></span> tab) 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky16.png"></div>
<p> 
			
</p>
<p>After the build path is set up return to the model and navigate the cursor at the beginning of the model and import the timing service: </p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;Blinky&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;import&nbsp;room.basic.service.timing.*&nbsp;from&nbsp;"../../org.eclipse.etrice.modellib/models/TimingService.room"&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;LogicalSystem&nbsp;System_Blinky&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubSystemRef&nbsp;subsystem:&nbsp;SubSystem_Blinky<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>
...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Make sure that the path fits to your folder structure. The original tutorial code is different due to the folder structure.  </p>
<p>Now it can be used within the model. Right click to 
				<span class="bold"><strong>SubSystem_Blinky</strong></span> within the outline view. Select 
				<span class="emphasis"><em>Edit Structure</em></span>. The 
				<span class="emphasis"><em>application</em></span> is already referenced in the subsystem. Drag and Drop an 
				<span class="emphasis"><em>ActorRef</em></span> to the 
				<span class="bold"><strong>SubSystem_Blinky</strong></span> and name it 
				<span class="emphasis"><em>timingService</em></span>. From the actor class drop down list select 
				<span class="emphasis"><em>room.basic.service.timing.ATimingService</em></span>. Draw a 
				<span class="emphasis"><em>LayerConnection</em></span> from 
				<span class="emphasis"><em>application</em></span> to each service provision point (SPP) of the 
				<span class="emphasis"><em>timingService</em></span>. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky06.png"></div>
<p> 
			
</p>
<p>The current version of eTrice does not provide a graphical element for a service access point (SAP). Therefore the SAPs to access the timing service must be added in the .room file. Open the 
				<span class="emphasis"><em>Blinky.room</em></span> file and navigate to the 
				<span class="emphasis"><em>Blinky</em></span> actor. Add the following line to the structure of the actor:
			</p>
<div class="literallayout">
<p>
<code class="code">SAP&nbsp;timer:&nbsp;room.basic.service.timing.PTimeout<br>

</code>
</p>
</div>
<p>Do the same thing for 
				<span class="emphasis"><em>BlinkyController</em></span>.
			</p>
<p>The resulting code should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky07.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Finish the model structure">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Finishthemodelstructure"></a>Finish the model structure</h2>
</div>
</div>
</div>
<p>From the outline view right click to 
				<span class="emphasis"><em>Blinky</em></span> and select 
				<span class="emphasis"><em>Edit Structure</em></span>. Drag and Drop an 
				<span class="emphasis"><em>Interface Port</em></span> to the boarder of the 
				<span class="emphasis"><em>Blinky</em></span> actor. Note that an interface port is not possible inside the actor. Name the port 
				<span class="emphasis"><em>ControlPort</em></span> and select 
				<span class="emphasis"><em>BlinkyControlProtocol</em></span> from the drop down list. Uncheck 
				<span class="emphasis"><em>Conjugated</em></span> and 
				<span class="emphasis"><em>Is Relay Port</em></span>. Click 
				<span class="emphasis"><em>ok</em></span>. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky04.png"></div>
<p>
			
</p>
<p>Repeat the above steps for the 
				<span class="emphasis"><em>BlinkyController</em></span>. Make the port 
				<span class="emphasis"><em>Conjugated</em></span>
			
</p>
<p>Keep in mind that the protocol defines 
				<span class="emphasis"><em>start</em></span> and 
				<span class="emphasis"><em>stop</em></span> as incoming messages. 
				<span class="emphasis"><em>Blinky</em></span> receives this messages and therefore 
				<span class="emphasis"><em>Blinky</em></span>'s 
				<span class="emphasis"><em>ControlPort</em></span> must be a regular port and 
				<span class="emphasis"><em>BlinkyController</em></span>'s 
				<span class="emphasis"><em>ControlPort</em></span> must be a conjugated port.
			</p>
<p>From the outline view right click 
				<span class="emphasis"><em>BlinkyTop</em></span> and select 
				<span class="emphasis"><em>Edit Structure</em></span>.
			</p>
<p>Drag and Drop an 
				<span class="emphasis"><em>ActorRef</em></span> inside the 
				<span class="emphasis"><em>BlinkyTop</em></span> actor. Name it 
				<span class="emphasis"><em>blinky</em></span>. From the actor class drop down list select 
				<span class="emphasis"><em>Blinky</em></span>. Do the same for 
				<span class="emphasis"><em>controller</em></span>. Connect the ports via the binding tool. The resulting structure should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky05.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Implement the Behavior">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ImplementtheBehavior"></a>Implement the Behavior</h2>
</div>
</div>
</div>
<p>The application should switch on and off the LED for 5 seconds in a 1 second interval, then stop blinking for 5 seconds and start again. To implement this behavior we will implement two FSMs. One for the 1 second interval and one for the 5 second interval. The 1 second blinking should be implemented in 
				<span class="emphasis"><em>Blinky</em></span>. The 5 second interval should be implemented in 
				<span class="emphasis"><em>BlinkyController</em></span>. First implement the Controller.
			</p>
<p>Right click to 
				<span class="emphasis"><em>BlinkyController</em></span> and select 
				<span class="emphasis"><em>Edit Behavior</em></span>.
				Drag and Drop the 
				<span class="emphasis"><em>Initial Point</em></span> and two 
				<span class="emphasis"><em>States</em></span> into the top state. Name the states 
				<span class="emphasis"><em>on</em></span> and 
				<span class="emphasis"><em>off</em></span>. 
				Use the 
				<span class="emphasis"><em>Transition</em></span> tool to draw transitions from 
				<span class="emphasis"><em>init</em></span> to 
				<span class="emphasis"><em>on</em></span> from 
				<span class="emphasis"><em>on</em></span> to 
				<span class="emphasis"><em>off</em></span> and from 
				<span class="emphasis"><em>off</em></span> to 
				<span class="emphasis"><em>on</em></span>.
			</p>
<p>Open the transition dialog by double click the arrow to specify the trigger event and the action code of each transition. Note that the initial transition does not have a trigger event.</p>
<p>The transition dialog should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky09.png"></div>
<p> 
			
</p>
<p>The defined ports will be generated as a member attribute of the actor class from type of the attached protocol. So, to send e message you must state 
				<span class="emphasis"><em>port.message(param);</em></span>. In this example 
				<span class="emphasis"><em>ControlPort.start()</em></span> sends the 
				<span class="emphasis"><em>start</em></span> message via the 
				<span class="emphasis"><em>ControlPort</em></span> to the outside world. Assuming that 
				<span class="emphasis"><em>Blinky</em></span> is connected to this port, the message will start the one second blinking FSM. It is the same thing with the 
				<span class="emphasis"><em>timer</em></span>. The SAP is also a port and follows the same rules. So it is clear that 
				<span class="emphasis"><em>timer.Start(5000);</em></span> will send the 
				<span class="emphasis"><em>Start</em></span> message to the timing service. The timing service will send a 
				<span class="emphasis"><em>timeoutTick</em></span> message back after 5000ms.
			</p>
<p>Within each transition the timer will be restarted and the appropriate message will be sent via the 
				<span class="emphasis"><em>ControlPort</em></span>. 
			</p>
<p>The resulting state machine should look like this:
				(Note that the arrows peak changes if the transition contains action code.)</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky10.png"></div>
<p>
			
</p>
<p>Save the diagram and inspect the 
				<span class="emphasis"><em>Blinky.room</em></span> file. The 
				<span class="emphasis"><em>BlinkyController</em></span> should look like this:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky11.png"></div>
<p> 
			
</p>
<p>Now we will implement 
				<span class="emphasis"><em>Blinky</em></span>. Due to the fact that 
				<span class="emphasis"><em>Blinky</em></span> interacts with the GUI class a view things must to be done in the model file.
			</p>
<p>Double click 
				<span class="emphasis"><em>Blinky</em></span> in the outline view to navigate to 
				<span class="emphasis"><em>Blinky</em></span> within the model file.
				Add the following code:
				(type it or simply copy it from the tutorial project)
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky12.png"></div>
<p> 
			
</p>
<p>
				
<span class="emphasis"><em>usercode1</em></span> will be generated at the beginning of the file, outside the class definition. 
				<span class="emphasis"><em>usercode2</em></span> will be generated within the class definition. The code imports the GUI class and instantiates the window class. Attributes for the carLights and pedLights will be declared to easily access the lights in the state machine.
				The Operation 
				<span class="emphasis"><em>destroyUser()</em></span> is a predefined operation that will be called during shutdown of the application. Within this operation, cleanup of manual coded classes can be done.
			</p>
<p>Now design the FSM of 
				<span class="emphasis"><em>Blinky</em></span>. Remember, as the name suggested 
				<span class="emphasis"><em>blinking</em></span> is a state in which the LED must be switched on and off. We will realize that by an hierarchical FSM in which the 
				<span class="emphasis"><em>blinking</em></span> state has two sub states.
			</p>
<p>Open the behavior diagram of 
				<span class="emphasis"><em>Blinky</em></span> by right clicking the 
				<span class="emphasis"><em>Blinky</em></span> actor in the outline view. Create two states named 
				<span class="emphasis"><em>blinking</em></span> and 
				<span class="emphasis"><em>off</em></span>. Right click to 
				<span class="emphasis"><em>blinking</em></span> and create a subgraph.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky13.png"></div>
<p>
			
</p>
<p>Create the following state machine. The trigger events between 
				<span class="emphasis"><em>on</em></span> and 
				<span class="emphasis"><em>off</em></span> are the 
				<span class="emphasis"><em>timeoutTick</em></span> from the 
				<span class="emphasis"><em>timer</em></span> port. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky14.png"></div>
<p>
			
</p>
<p>Create entry code for both states by right clicking the state and select 
				<span class="emphasis"><em>Edit State...</em></span>
			
</p>
<p>Entry code of 
				<span class="emphasis"><em>on</em></span> is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Start(1000);<br>
carLights.setState(TrafficLight3.YELLOW);&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Entry code  of 
				<span class="emphasis"><em>off</em></span> is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Start(1000);<br>
carLights.setState(TrafficLight3.OFF);<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Navigate to the Top level state by double clicking the 
				<span class="emphasis"><em>/blinking</em></span> state. Create the following state machine:
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky15.png"></div>
<p>
			
</p>
<p>The trigger event from 
				<span class="emphasis"><em>off</em></span> to 
				<span class="emphasis"><em>blinking</em></span> is the 
				<span class="emphasis"><em>start</em></span> event from the 
				<span class="emphasis"><em>ControlPort</em></span>.The trigger event from 
				<span class="emphasis"><em>blinking</em></span> to 
				<span class="emphasis"><em>off</em></span> is the 
				<span class="emphasis"><em>stop</em></span> event from the 
				<span class="emphasis"><em>ControlPort</em></span>.
				Note: The transition from 
				<span class="emphasis"><em>blinking</em></span> to 
				<span class="emphasis"><em>off</em></span> is a so called group transition. This is a outgoing transition from a super state (state with sub states) without specifying the concrete leave state (state without sub states). An incoming transition to a super state is called history transition.   
			</p>
<p>Action code of the init transition is:</p>
<div class="literallayout">
<p>
<code class="code">carLights&nbsp;=&nbsp;light.getCarLights();<br>
pedLights&nbsp;=&nbsp;light.getPedLights();<br>
carLights.setState(TrafficLight3.OFF);<br>
pedLights.setState(TrafficLight2.OFF);<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Action code from 
				<span class="emphasis"><em>blinking</em></span> to 
				<span class="emphasis"><em>off</em></span> is:
			</p>
<div class="literallayout">
<p>
<code class="code">timer.Kill();<br>
carLights.setState(TrafficLight3.OFF);&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The model is complete now. You can run and debug the model as described in getting started. Have fun.</p>
<p>The complete model can be found in /org.eclipse.etrice.tutorials/model/Blinky.</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary2"></a>Summary</h2>
</div>
</div>
</div>
<p>Run the model and take a look at the generated MSCs. Inspect the generated code to understand the runtime model of eTrice. Within this tutorial you have learned how to create a hierarchical FSM with group transitions and history transitions and you have used entry code. You are now familiar with the basic features of eTrice. The further tutorials will take this knowledge as a precondition.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;7.&nbsp;Tutorial Sending Data (Java)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialSendingDataJava"></a>Chapter&nbsp;7.&nbsp;Tutorial Sending Data (Java)</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope3"></a>Scope</h2>
</div>
</div>
</div>
<p>This tutorial shows how data will be sent in a eTrice model. Within the example you will create two actors (MrPing and MrPong). MrPong will simply loop back every data it received.
				MrPing will send data and verify the result.   </p>
<p>You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch</p>
</li>
<li class="listitem">
<p>create a data class</p>
</li>
<li class="listitem">
<p>define a protocol with attached data</p>
</li>
<li class="listitem">
<p>create an actor structure</p>
</li>
<li class="listitem">
<p>create two simple state machines</p>
</li>
<li class="listitem">
<p>build and run the model</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch3"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Remember exercise 
				<span class="emphasis"><em>HelloWorld</em></span>.
				Create a new eTrice project and name it 
				<span class="emphasis"><em>SendingData</em></span>
				Open the 
				<span class="emphasis"><em>SendingData.room</em></span> file and copy the following code into the file or use content assist to create the model.
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;SendingData&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;LogicalSystem&nbsp;SendingData_LogSystem&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubSystemRef&nbsp;SendingDataAppl:SendingData_SubSystem&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;SubSystemClass&nbsp;SendingData_SubSystem&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActorRef&nbsp;SendigDataTopRef:SendingDataTop&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;SendingDataTop&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Add a data class">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Addadataclass"></a>Add a data class</h2>
</div>
</div>
</div>
<p>Position the cursor outside any class definition and right click the mouse within the editor window. From the context menu select 
				<span class="emphasis"><em>Content Assist</em></span> (or Ctrl+Space).  
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData01.png"></div>
<p>
			
</p>
<p>Select 
				<span class="emphasis"><em>DataClass &ndash; data class skeleton</em></span> and name it 
				<span class="emphasis"><em>DemoData</em></span>.
				Remove the operations and add the following Attributes:
			</p>
<div class="literallayout">
<p>
<code class="code">DataClass&nbsp;DemoData&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;int32Val:&nbsp;int32&nbsp;=&nbsp;"4711"<br>
&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;int8Array&nbsp;[&nbsp;10&nbsp;]:&nbsp;int8&nbsp;=&nbsp;"{1,2,3,4,5,6,7,8,9,10}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;float64Val:&nbsp;float64&nbsp;=&nbsp;"0.0"<br>
&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;stringVal:&nbsp;string&nbsp;=&nbsp;"\"empty\""<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>Save the model and visit the outline view.
				Note that the outline view contains all data elements as defined in the model. </p>
</div>
<div class="section" title="Create a new protocol">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewprotocol2"></a>Create a new protocol</h2>
</div>
</div>
</div>
<p>With the help of 
				<span class="emphasis"><em>Content Assist</em></span> create a 
				<span class="emphasis"><em>ProtocolClass</em></span> and name it 
				<span class="emphasis"><em>PingPongProtocol</em></span>. Create the following messages:
			</p>
<div class="literallayout">
<p>
<code class="code">ProtocolClass&nbsp;PingPongProtocol&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;incoming&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;ping(data:&nbsp;DemoData)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pingSimple(data:int32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;outgoing&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pong(data:&nbsp;DemoData)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pongSimple(data:int32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}&nbsp;&nbsp;&nbsp;&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Create MrPing and MrPong Actors">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CreateMrPingandMrPongActors"></a>Create MrPing and MrPong Actors</h2>
</div>
</div>
</div>
<p>With the help of 
				<span class="emphasis"><em>Content Assist</em></span> create two new actor classes and name them 
				<span class="emphasis"><em>MrPing</em></span> and 
				<span class="emphasis"><em>MrPong</em></span>. The resulting model should look like this:
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;SendingData&nbsp;{<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;LogicalSystem&nbsp;SendingData_LogSystem&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SubSystemRef&nbsp;SendingDataAppl:&nbsp;SendingData_SubSystem<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;SubSystemClass&nbsp;SendingData_SubSystem&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ActorRef&nbsp;SendigDataTopRef:&nbsp;SendingDataTop<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;SendingDataTop&nbsp;{&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;DataClass&nbsp;DemoData&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;int32Val:&nbsp;int32&nbsp;=&nbsp;"4711"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;int8Array&nbsp;[&nbsp;10&nbsp;]:&nbsp;int8&nbsp;=&nbsp;"{1,2,3,4,5,6,7,8,9,10}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;float64Val:&nbsp;float64&nbsp;=&nbsp;"0.0"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Attribute&nbsp;stringVal:&nbsp;string&nbsp;=&nbsp;"\"empty\""<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ProtocolClass&nbsp;PingPongProtocol&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;incoming&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;ping(data:&nbsp;DemoData)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pingSimple(data:&nbsp;int32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outgoing&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pong(data:&nbsp;DemoData)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Message&nbsp;pongSimple(data:&nbsp;int32)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;MrPing&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Interface&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Structure&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Behavior&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

<br>
&nbsp;&nbsp;&nbsp;&nbsp;ActorClass&nbsp;MrPong&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Interface&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Structure&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Behavior&nbsp;{&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
}&nbsp;<br>

<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>The outline view should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData03.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Define Actor Structure and Behavior">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DefineActorStructureandBehavior"></a>Define Actor Structure and Behavior</h2>
</div>
</div>
</div>
<p>Save the model and visit the outline view. Within the outline view, right click on the 
				<span class="emphasis"><em>MrPong</em></span> actor and select 
				<span class="emphasis"><em>Edit Structure</em></span>. Select an 
				<span class="emphasis"><em>Interface Port</em></span> from the toolbox and add it to MrPong. Name the Port 
				<span class="emphasis"><em>PingPongPort</em></span> and select the 
				<span class="emphasis"><em>PingPongProtocol</em></span>
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData02.png"></div>
<p>
			
</p>
<p>Do the same with MrPing but mark the port as 
				<span class="emphasis"><em>conjugated</em></span>
			
</p>
<div class="section" title="Define MrPongs behavior">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefineMrPongsbehavior"></a>Define MrPongs behavior</h3>
</div>
</div>
</div>
<p>Within the outline view, right click MrPong and select 
					<span class="emphasis"><em>Edit Behavior</em></span>. Create the following state machine:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData04.png"></div>
<p>
				
</p>
<p>The transition dialogues should look like this:
					For 
					<span class="emphasis"><em>ping</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData05.png"></div>
<p>
				
</p>
<p>For 
					<span class="emphasis"><em>pingSimple</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData06.png"></div>
<p>
				
</p>
</div>
<div class="section" title="Define MrPing behavior">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="DefineMrPingbehavior"></a>Define MrPing behavior</h3>
</div>
</div>
</div>
<p>Within the outline view double click MrPing. Navigate the cursor to the behavior of MrPing. With the help of content assist create a new operation.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData07.png"></div>
<p>
				
</p>
<p>Name the operation 
					<span class="emphasis"><em>printData</em></span> and define the DemoData as a parameter.
				</p>
<p>Fill in the following code:</p>
<div class="literallayout">
<p>
<code class="code">Operation&nbsp;printData(d:&nbsp;DemoData)&nbsp;:&nbsp;void&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System.out.printf(\"d.int32Val:&nbsp;%d\\n\",d.int32Val);"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System.out.printf(\"d.float64Val:&nbsp;%f\\n\",d.float64Val);"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System.out.printf(\"d.int8Array:&nbsp;\");"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"for(int&nbsp;i&nbsp;=&nbsp;0;&nbsp;i&lt;d.int8Array.length;&nbsp;i++)&nbsp;{"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System.out.printf(\"%d&nbsp;\",d.int8Array[i]);}"<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"System.out.printf(\"\\nd.stringVal:&nbsp;%s\\n\",d.stringVal);"<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>For MrPing create the following state machine:
					(Remember that you can copy and paste the action code from the tutorial directory.)</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData08.png"></div>
<p>
				
</p>
<p>The transition dialogues should look like this:</p>
<p>For 
					<span class="emphasis"><em>init</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData09.png"></div>
<p>
				
</p>
<p>For 
					<span class="emphasis"><em>wait1</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData10.png"></div>
<p>
				
</p>
<p>For 
					<span class="emphasis"><em>next</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData11.png"></div>
<p>
				
</p>
<p>For 
					<span class="emphasis"><em>wait2</em></span>:
				</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/025-SendingData12.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Define the top level">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Definethetoplevel"></a>Define the top level</h2>
</div>
</div>
</div>
<p>Open the Structure from SendingDataTop and add MrPing and MrPong as a reference. Connect the ports.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/025-SendingData13.png"></div>
<p>
			
</p>
<p>The model is finished now and can be found in /org.eclipse.etrice.tutorials/model/SendingData.</p>
</div>
<div class="section" title="Generate and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Generateandrunthemodel"></a>Generate and run the model</h2>
</div>
</div>
</div>
<p>Generate the code by right click to 
				<span class="bold"><strong>gen_SendingData.launch</strong></span> and run it as 
				<span class="bold"><strong>gen_SendingData</strong></span>. Run the model. 
				The output should look like this:
			</p>
<div class="blockquote">
<blockquote class="blockquote">
<p>
					type &sbquo;quit&rsquo; to exit
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 1
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 2
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 3
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 4
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 5
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 6
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 7
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 8
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 9
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPongSimple
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					data: 10
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					/SendingData_SubSystem/SendigDataTopRef/ref1 -&gt; looping
					d.int32Val: 4711
					d.float64Val: 0,000000
					d.int8Array: 1 2 3 4 5 6 7 8 9 10 
					d.stringVal: empty
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
					d.int32Val: 815
					d.float64Val: 3,141234
					d.int8Array: 100 101 102 103 104 105 106 107 108 109 
					d.stringVal: some contents
					/SendingData_SubSystem/SendigDataTopRef/ref0 -&gt; waitForPong
					quit
					echo: quit</p>
</blockquote>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary3"></a>Summary</h2>
</div>
</div>
</div>
<p>Within the first loop an integer value will be incremented by 
				<span class="emphasis"><em>MrPong</em></span> and sent back to 
				<span class="emphasis"><em>MrPing</em></span>. As long as the guard is true 
				<span class="emphasis"><em>MrPing</em></span> sends back the value.
			</p>
<p>Within the 
				<span class="emphasis"><em>next</em></span> transition, 
				<span class="emphasis"><em>MrPing</em></span> creates a data class and sends the default values. Then 
				<span class="emphasis"><em>MrPing</em></span> changes the values and sends the class again. At this point you should note that during the send operation, a copy of the data class will be created and sent. Otherwise it would not be possible to send the same object two times, even more it would not be possible to send a stack object at all. This type of data passing is called 
				<span class="emphasis"><em>sending data by value</em></span>.
				However, for performance reasons some applications requires 
				<span class="emphasis"><em>sending data by reference</em></span>. In this case the user is responsible for the life cycle of the object. In Java the VM takes care of the life cycle of an object. This is not the case for C/C++. Consider that a object which is created within a transition of a state machine will be destroyed when the transition is finished. The receiving FSM would receive an invalid reference. Therefore care must be taken when sending references.      
			</p>
<p>For sending data by reference you simply have to add the keyword 
				<span class="emphasis"><em>ref</em></span> to the protocol definition.
			</p>
<div class="literallayout">
<p>
<code class="code">Message&nbsp;ping(data:&nbsp;DemoData&nbsp;ref)<br>

</code>
</p>
</div>
<p>Make the test and inspect the console output.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;8.&nbsp;Tutorial Pedestrian Lights (Java)">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialPedestrianLightsJava"></a>Chapter&nbsp;8.&nbsp;Tutorial Pedestrian Lights (Java)</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope4"></a>Scope</h2>
</div>
</div>
</div>
<p>The scope of this tutorial is to demonstrate how to receive model messages from outside the model. Calling methods which are not part of the model is simple and you have already done this within the blinky tutorial (this is the other way round: model =&gt; external code). Receiving events from outside the model is a very common problem and a very frequently asked question. Therefore this tutorial shows how an external event (outside the model) can be received by the model.</p>
<p>This tutorial is not like hello world or blinky. Being familiar with the basic tool features is mandatory for this tutorial. The goal is to understand the mechanism not to learn the tool features.</p>
<p>The idea behind the exercise is, to control a Pedestrian crossing light. We will use the same GUI as for the blinky tutorial but now we will use the 
				<span class="emphasis"><em>REQUEST</em></span> button to start a FSM, which controls the traffic lights.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/020-Blinky08.png"></div>
<p>
			
</p>
<p>The 
				<span class="emphasis"><em>REQUEST</em></span> must lead to a model message which starts the activity of the lights.
			</p>
<p>There are several possibilities to receive external events (e.g. TCP/UDP Socket, using OS messaging mechanism), but the easiest way is, to make a port usable from outside the model. To do that a few steps are necessary:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>specify the messages (within a protocol) which should be sent into the model</p>
</li>
<li class="listitem">
<p>model an actor with a port (which uses the specified protocol) and connect the port to the receiver </p>
</li>
<li class="listitem">
<p>the external code should know the port (import of the port class)</p>
</li>
<li class="listitem">
<p>the external code should provide a registration method, so that the actor is able to allow access to this port</p>
</li>
<li class="listitem">
<p>the port can be used from the external code</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Setup the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Setupthemodel"></a>Setup the model</h2>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Use the 
						<span class="emphasis"><em>New Model Wizzard</em></span> to create a new eTrice project and name it 
						<span class="emphasis"><em>PedLightsController</em></span>.
					</p>
</li>
<li class="listitem">
<p>Copy the package 
						<span class="emphasis"><em>org.eclipse.etrice.tutorials.PedLightGUI</em></span> to your 
						<span class="emphasis"><em>src</em></span> directory (see blinky tutorial).
					</p>
</li>
<li class="listitem">
<p>In PedestrianLightWndNoTcp.jav uncomment line 15 (import), 36, 122 (usage) and 132-134 (registration). The error markers will disappear after the code is generated from the model.</p>
</li>
<li class="listitem">
<p>Copy the model from /org.eclipse.etrice.tutorials/model/PedLightsController to your model file, or run the model directly in the tutorial directory. </p>
</li>
<li class="listitem">
<p>Adapt the import statement to your path.</p>
</li>
</ul>
</div>
<div class="literallayout">
<p>
<code class="code">import&nbsp;room.basic.service.timing.*&nbsp;from&nbsp;"../../org.eclipse.etrice.modellib/models/TimingService.room"&nbsp;<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Generate the code from the model.</p>
</li>
<li class="listitem">
<p>Add the org.eclipse.etrice.modellib to the Java Class Path of your project.</p>
</li>
<li class="listitem">
<p>All error markers should be disappeared and the model should be operable. </p>
</li>
<li class="listitem">
<p>Arrange the Structure and the Statemachines to understand the model</p>
</li>
</ul>
</div>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights01.png"></div>
<p>
				The 
				<span class="emphasis"><em>GuiAdapter</em></span> represents the interface to the external code. It registers its 
				<span class="emphasis"><em>ControlPort</em></span> by the external code.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights02.png"></div>
<p>
				Visit the initial transition to understand the registration. The actor handles the incoming messages as usual and controls the traffic lights as known from blinky. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights03.png"></div>
<p>
				The 
				<span class="emphasis"><em>Controller</em></span> receives the 
				<span class="emphasis"><em>start</em></span> message and controls the timing of the lights. Note that the 
				<span class="emphasis"><em>start</em></span> message will be sent from the external code whenever the 
				<span class="emphasis"><em>REQUEST</em></span> button is pressed.
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p> Visit the model and take a closer look to the following elements:</p>
</li>
</ul>
</div>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>PedControlProtocol =&gt; notice that the start message is defined as usual</p>
</li>
<li class="listitem">
<p>Initial transition of the 
						<span class="emphasis"><em>GuiAdapter</em></span> =&gt; see the registration
					</p>
</li>
<li class="listitem">
<p>The 
						<span class="emphasis"><em>Controller</em></span> =&gt; notice that the 
						<span class="emphasis"><em>Controller</em></span> receives the external message (not the 
						<span class="emphasis"><em>GuiAdapter</em></span>). The 
						<span class="emphasis"><em>GuiAdapter</em></span> just provides its port and handles the incoming messages.
					</p>
</li>
<li class="listitem">
<p>Visit the hand written code =&gt; see the import statement of the protocol class and the usage of the port.</p>
</li>
</ol>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Generate and test the model</p>
</li>
<li class="listitem">
<p>Take a look at the generated MSC =&gt; notice that the start message will shown as if the 
						<span class="emphasis"><em>GuiAdapter</em></span> had sent it.
					</p>
</li>
</ul>
</div>
<p>
				
</p>
<div class="mediaobject">
<img src="images/030-PedLights04.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Why does it work and why is it safe?">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Whydoesitworkandwhyisitsafe"></a>Why does it work and why is it safe?</h2>
</div>
</div>
</div>
<p>The tutorial shows that it is generally possible to use every port from outside the model as long as the port knows its peer. This is guaranteed by describing protocol and the complete structure (especially the bindings) within the model. 
				The only remaining question is: Why is it safe and does not violate the 
				<span class="bold"><strong>run to completion</strong></span> semantic. To answer this question, take a look at the 
				<span class="emphasis"><em>MessageService.java</em></span> from the runtime environment. There you will find the receive method which puts each message into the queue. 
			</p>
<div class="literallayout">
<p>
<code class="code">&nbsp;&nbsp;&nbsp;&nbsp;@Override<br>
&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;synchronized&nbsp;void&nbsp;receive(Message&nbsp;msg)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(msg!=null)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;messageQueue.push(msg);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;notifyAll();&nbsp;//&nbsp;wake&nbsp;up&nbsp;thread&nbsp;to&nbsp;compute&nbsp;message<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>This method is synchronized. That means, regardless who sends the message, the queue is secured. If we later on (e.g. for performance reasons in C/C++) distinguish between internal and external senders (same thread or not), care must be taken to use the external (secure) queue.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;9.&nbsp;Setting up the Workspace for C Projects">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="SettinguptheWorkspaceforCProjects"></a>Chapter&nbsp;9.&nbsp;Setting up the Workspace for C Projects</h2>
</div>
</div>
</div>
<p>Before you can start with C, some preconditions must be fulfilled:</p>
<p>- A C compiler must be installed on your machine (all tests and tutorials are based on MinGW)
			- The CDT-Eclipse plug in must be installed as the C development environment.</p>
<p>Once the CDT is installed, the C runtime and model library must be imported. 
			(
			<span class="emphasis"><em>File-&gt;New-&gt;Project-&gt;eTrice</em></span> select 
			<span class="emphasis"><em>eTrice C runtime</em></span> / 
			<span class="emphasis"><em>eTrice C modellib</em></span>)
		</p>
<p>The resulting workspace should look like this:</p>
<p>
			
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC01.png"></div>
<p>
		
</p>
<div class="section" title="Testing the environment">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Testingtheenvironment"></a>Testing the environment</h2>
</div>
</div>
</div>
<p>To verify the C tool chain you should generate and run the Hello World example program of the CDT.
				 Activate the 
				<span class="emphasis"><em>C/C++</em></span> perspective. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC03.png"></div>
<p>
			
</p>
<p>From the main menu select 
				<span class="emphasis"><em>File-&gt;New-&gt;C Project</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC02.png"></div>
<p>
			
</p>
<p>Name the project. Select an 
				<span class="emphasis"><em>Executable-&gt;Hello World ANSI C</em></span> as project type, 
				<span class="emphasis"><em>MinGW GCC</em></span> as tool chain and click 
				<span class="emphasis"><em>Finish</em></span>. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC04.png"></div>
<p> 
			
</p>
<p>Select the new project and click the build button (or right click the project and select 
				<span class="emphasis"><em>Build Project</em></span>)
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC05.png"></div>
<p>
			
</p>
<p>The binary should be generated. Run the binary as 
				<span class="emphasis"><em>Local C/C++ Application</em></span>
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC06.png"></div>
<p>
			
</p>
<p>Verify the output.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC07.png"></div>
<p>
			
</p>
<p>Remember these steps. In the following Tutorials these steps will be referenced as 
				<span class="emphasis"><em>build and run</em></span>.
			</p>
</div>
<div class="section" title="Building the C runtime system">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="BuildingtheCruntimesystem"></a>Building the C runtime system</h2>
</div>
</div>
</div>
<p>The C runtime system contains some basic functionalities to run the generated models. The so called runtime is common for all C projects. The requirements for several projects may differ depending on the functionality of the model or the resources of the different platforms. Therefore the runtime is configurable in terms of message queue size, frequency and memory alignment. The configuration file 
				<span class="emphasis"><em>etRuntimeConfig.h</em></span> is located in 
				<span class="emphasis"><em>src/config</em></span>.
			</p>
<p>After changing the configuration, the runtime must be built.</p>
<p>Open the properties of the 
				<span class="emphasis"><em>org.eclipse.runtime.c</em></span> project and select 
				<span class="emphasis"><em>C/C++ Build-&gt;Settings-&gt;Tool Settings</em></span> and select 
				<span class="emphasis"><em>Includes</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC08.png"></div>
<p>
			
</p>
<p>Verify the include paths</p>
<p>
				
<span class="emphasis"><em>src/config</em></span>

				<span class="emphasis"><em>src/common</em></span>

				<span class="emphasis"><em>src/platforms/generic</em></span>
			
</p>
<p>Within the Setting dialog select the tab 
				<span class="emphasis"><em>Build Artefact</em></span> and select 
				<span class="emphasis"><em>Static Library</em></span>
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC09.png"></div>
<p>
			
</p>
<p>Build the runtime by clicking</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC10.png"></div>
<p>
			
</p>
<p>The runtime library should be created.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/032-SetupWorkspaceC11.png"></div>
<p>
			
</p>
<p>For the tutorials one runtime library should be sufficient. For embedded projects it might be necessary to build project specific runtime libraries. In this case a separate project for the runtime should be created. Symbolic links to the sources might be used to avoid duplicate files. Just the configuration file must be duplicated. A specific library file must exist within the project. Such specific runtime libraries might be referenced from several applications.     </p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;10.&nbsp;Tutorial HelloWorld for C">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialHelloWorldforC"></a>Chapter&nbsp;10.&nbsp;Tutorial HelloWorld for C</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope5"></a>Scope</h2>
</div>
</div>
</div>
<p>In this tutorial you will learn how to create a model for C from scratch. There are some more steps to do in C compared to Java. The goal is to get familiar with the additional steps. The Java tutorial is a prerequisite for the following explanations. 
				You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch for C</p>
</li>
<li class="listitem">
<p>create structure and behavior similar to Java</p>
</li>
<li class="listitem">
<p>create a launch configuration for the C code generator</p>
</li>
<li class="listitem">
<p>setup the C environment</p>
</li>
<li class="listitem">
<p>generate the source code</p>
</li>
<li class="listitem">
<p>run the model</p>
</li>
</ol>
</div>
<p>Make sure that you have set up the workspace as described in 
				<span class="emphasis"><em>Setting up the Workspace for C Projects</em></span>.
			</p>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch4"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Before you can create a new C-model, you have to create a new C project as described in 
				<span class="emphasis"><em>Setting up the Workspace for C Projects</em></span>.
				Remember:
				- select the 
				<span class="emphasis"><em>C/C++</em></span> perspective
				- From the main menue select 
				<span class="emphasis"><em>File-&gt;New-&gt;C Project</em></span>
				- Name the project 
				<span class="emphasis"><em>HelloWorldC</em></span>
				- Project type is 
				<span class="emphasis"><em>Executable / Empty C Project</em></span>
				- Toolchain is 
				<span class="emphasis"><em>MinGW</em></span>
			
</p>
<p>The workspace should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC01.png"></div>
<p>
			
</p>
<p>The next step is to add the model folder:
				Right click on the new project. Select 
				<span class="emphasis"><em>New-&gt;Folder</em></span> and name it 
				<span class="emphasis"><em>model</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC02.png"></div>
<p>
			
</p>
<p>Add the model file to the folder. Right click on the new folder. Select 
				<span class="emphasis"><em>New-&gt;file</em></span> and name it 
				<span class="emphasis"><em>HelloWorldC.room</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC03.png"></div>
<p>
			
</p>
<p>Due to the file ending 
				<span class="emphasis"><em>.room</em></span>, the tool will ask you to add the Xtext nature. Answer with 
				<span class="emphasis"><em>Yes</em></span>. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC04.png"></div>
<p>
			
</p>
<p>The workspace should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC05.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Create the HelloWorld model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CreatetheHelloWorldmodel"></a>Create the HelloWorld model</h2>
</div>
</div>
</div>
<p>Once the model file is created and the Xtext nature is added, you can create the model as you did it for Java.
				Creating the model is not the focus of this tutorial. Therefore copy and paste the following code into your model file. Optionally you can open and layout the diagrams.  
				Recognize the C specific parts:
				- The action code contains C instead of Java. Later versions will contain a common action language, but for the moment the action language is target specific.
				- The application must be shutdown on model level (see also 
				<span class="emphasis"><em>etRuntimeConfig.h</em></span>).  
			</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;HelloWorldCModel&nbsp;{<br>
	import&nbsp;room.basic.types.*&nbsp;from&nbsp;"../../org.eclipse.etrice.modellib.c/model/Types.room"<br>
	SubSystemClass&nbsp;HelloWorldCSubSysClass&nbsp;{<br>
		ActorRef&nbsp;HelloETriceTopRef:AHelloWorldCTop&nbsp;<br>
	}<br>
	ActorClass&nbsp;AHelloWorldCTop&nbsp;{<br>
		Structure&nbsp;{&nbsp;}<br>
		Behavior&nbsp;{<br>
			StateMachine&nbsp;{<br>
				Transition&nbsp;init:&nbsp;initial&nbsp;-&gt;&nbsp;state0&nbsp;{&nbsp;}<br>
				State&nbsp;state0&nbsp;{<br>
					entry&nbsp;{<br>
						"printf(\"HelloWorldC&nbsp;!\\n\");"<br>
						"SubSysClass_shutdown();"<br>
						"\t\t\t\t\t\t"<br>
					}<br>
				}<br>
			}<br>
		}<br>
	}	<br>
}<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
</div>
<div class="section" title="Create a launch configuration to start the C code generator">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="CreatealaunchconfigurationtostarttheCcodegenerator"></a>Create a launch configuration to start the C code generator</h2>
</div>
</div>
</div>
<p>Other than in Java a launch configuration for the C code generator must be created.</p>
<p>From the 
				<span class="emphasis"><em>Run</em></span> menu select 
				<span class="emphasis"><em>Run Configurations</em></span>
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC06.png"></div>
<p>
			
</p>
<p>Within the dialog select 
				<span class="emphasis"><em>eTrice C Generator</em></span> and click the 
				<span class="emphasis"><em>New</em></span> button to create a new launch configuration.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC07.png"></div>
<p>
			
</p>
<p>A new configuration should be created. Name it 
				<span class="emphasis"><em>gen_HelloWorldC</em></span> and add the model via one of the 
				<span class="emphasis"><em>add</em></span> buttons.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC08.png"></div>
<p>
			
</p>
<p>In the 
				<span class="emphasis"><em>Refresh</em></span> tab select 
				<span class="emphasis"><em>The entire workspace</em></span> 
			
</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC09.png"></div>
<p>
			
</p>
<p>In the 
				<span class="emphasis"><em>Common</em></span> tab select 
				<span class="emphasis"><em>Shared file</em></span> and add the 
				<span class="emphasis"><em>HelloWorldC</em></span> project via the 
				<span class="emphasis"><em>Browse</em></span> button.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC10.png"></div>
<p>
			
</p>
<p>Apply your changes. The new configuration should now exist in your workspace.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC11.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Generate the code">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Generatethecode"></a>Generate the code</h2>
</div>
</div>
</div>
<p>Now you can generate the code as you know it from Java. Right click on the launch configuration and run it as 
				<span class="emphasis"><em>gen_HelloWorldC</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC12.png"></div>
<p>
			
</p>
<p>The code should be generated.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC13.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Setup the include path">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Setuptheincludepath"></a>Setup the include path</h2>
</div>
</div>
</div>
<p>Before you can build the application you must setup the include path for the runtime system. Right click the project and select 
				<span class="emphasis"><em>Properties</em></span>. Add the include path as described in 
				<span class="emphasis"><em>setting up the workspace</em></span>.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC14.png"></div>
<p>
			
</p>
<p>Add the runtime library.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC15.png"></div>
<p>
			
</p>
<p>Recognize the name of the library (&bdquo;org.eclipse.etrice.runtime.c&rdquo;). The library file on your disk is &bdquo;liborg.eclipse.etrice.runtime.c.a&rdquo;. </p>
</div>
<div class="section" title="Build and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Buildandrunthemodel2"></a>Build and run the model</h2>
</div>
</div>
</div>
<p>Now you can build the application. Click the build button to build the application.
				Run the application as 
				<span class="emphasis"><em>Local C/C++ Application</em></span>.
				Verify the output.
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/034-HelloWorldC16.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary4"></a>Summary</h2>
</div>
</div>
</div>
<p>You are now familiar with all necessary steps to create, build and run an eTrice C model from scratch. You are able to create a launch configuration to start the code generator and to perform all necessary settings to compile and link the application.  </p>
<p>The next tutorial provides an exercise to get more familiar with these working steps.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;11.&nbsp;Tutorial Remove C-Comment ( C )">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="TutorialRemoveCCommentC"></a>Chapter&nbsp;11.&nbsp;Tutorial Remove C-Comment ( C )</h2>
</div>
</div>
</div>
<div class="section" title="Scope">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Scope6"></a>Scope</h2>
</div>
</div>
</div>
<p>In this tutorial you will create a more complex model. The model implements a simple parser that removes comments (block comments and line comments) from a C source file. Therefore we will create two actors. One actor is responsible to perform the file operations, whether the second actor implements the parser.</p>
<p>You will perform the following steps:</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>create a new model from scratch for C</p>
</li>
<li class="listitem">
<p>define a protocol</p>
</li>
<li class="listitem">
<p>define your own data type</p>
</li>
<li class="listitem">
<p>create the structure and the behavior by yourself</p>
</li>
<li class="listitem">
<p>generate, build and run the model</p>
</li>
</ol>
</div>
<p>Make sure that you have set up the workspace as described in 
				<span class="emphasis"><em>Setting up the Workspace for C Projects</em></span>.
			</p>
</div>
<div class="section" title="Create a new model from scratch">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createanewmodelfromscratch5"></a>Create a new model from scratch</h2>
</div>
</div>
</div>
<p>Remember the following steps from the previous tutorials:
				- select the 
				<span class="emphasis"><em>C/C++</em></span> perspective
				- From the main menue select 
				<span class="emphasis"><em>File-&gt;New-&gt;C Project</em></span>
				- Name the project 
				<span class="emphasis"><em>RemoveComment</em></span>
				- Project type is 
				<span class="emphasis"><em>Executable / Empty C Project</em></span>
				- Toolchain is 
				<span class="emphasis"><em>MinGW</em></span>
				- Add the folder 
				<span class="emphasis"><em>model</em></span>
				- Add the model file and name it 
				<span class="emphasis"><em>RemoveComment.room</em></span>
				- Add the Xtext nature.
			</p>
<p>The workspace should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC01.png"></div>
<p>
			
</p>
<p>Create a launch configuration for the C generator and add the include path and library as described in 
				<span class="emphasis"><em>HelloWorldC</em></span>.
			</p>
<p>The workspace should look like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC02.png"></div>
<p>
			
</p>
<p>Now the model is created and all settings for the code generator, compiler and linker are done.</p>
</div>
<div class="section" title="Create your own data type">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createyourowndatatype"></a>Create your own data type</h2>
</div>
</div>
</div>
<p>The planed application should read a C source file and remove the comments. Therefore we need a file descriptor which is not part of the basic C types. The type for the file descriptor for MinGW is 
				<span class="emphasis"><em>FILE</em></span>. To make this type available on the model level, you have to declare the type. 
			</p>
<p>Open the file 
				<span class="emphasis"><em>Types.room</em></span> from 
				<span class="emphasis"><em>org.eclipse.modellib.c</em></span> and take a look at the declaration of 
				<span class="emphasis"><em>string</em></span> (last line) which is not a basic C type.
			</p>
<p>
				
<span class="emphasis"><em>PrimitiveType string:ptCharacter -&gt; charPtr default "0"</em></span>
			
</p>
<p>With this declaration, you make the 
				<span class="emphasis"><em>string</em></span> keyword available on model level as a primitive type. This type will be translated to 
				<span class="emphasis"><em>charPtr</em></span> in your C sources. 
				<span class="emphasis"><em>charPtr</em></span> is defined in 
				<span class="emphasis"><em>etDatatypes.h</em></span>. This header file is platform specific (
				<span class="emphasis"><em>generic</em></span>). With this mechanism you can define your own type system on model level and map the model types to specific target/platform types. 
			</p>
<p>To not interfere with other models, we will declare the type direct in the model.
				Add the following line to your model:</p>
<div class="literallayout">
<p>
<code class="code">RoomModel&nbsp;RemoveComment&nbsp;{<br>
	import&nbsp;room.basic.types.*&nbsp;from&nbsp;"../../../org.eclipse.etrice.modellib.c/model/Types.room"<br>
	
<br>
	PrimitiveType&nbsp;file:ptInteger&nbsp;-&gt;&nbsp;FILE&nbsp;default&nbsp;"0"<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>
				
<span class="emphasis"><em>FILE</em></span> is the native type for MinGW. Therefore you don&acute;t need a mapping within 
				<span class="emphasis"><em>etDatatypes.h</em></span>. If your model should be portable across different platforms you should not take this shortcut.
			</p>
</div>
<div class="section" title="Create the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Createthemodel"></a>Create the model</h2>
</div>
</div>
</div>
<p>Due to the former tutorials you should be familiar with the steps to create the model with protocols, actors and state machines.</p>
<p>The basic idea of the exercise is to create a file reader actor, which is responsible to open, close and read characters from the source file. Another actor receives the characters and filters the comments (parser). The remaining characters (pure source code) should be print out. </p>
<p>Remember the logical steps: 
				- create the model by the help of content assist (CTRL Space)
				- name the model, subsystem and top level actor
				- define the protocol (in this case it should be able to send a char, and to request the next char from the file reader)
				- create the structure (file reader and parser with an appropriate port, create the references and connect the ports)
				- create the state machines</p>
<p>Try to create the model by yourself and take the following solution as an example.</p>
<p>Structure:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC04.png"></div>
<p>
			
</p>
<p>File reader FSM:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC05.png"></div>
<p>
			
</p>
<p>Parser FSM:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC06.png"></div>
<p>
			
</p>
<p>The complete model can be found in 
				<span class="emphasis"><em>org.eclipse.etrice.tutorials.c</em></span>
			
</p>
<p>Take a look at the file attribute of the file reader. </p>
<div class="literallayout">
<p>
<code class="code">Attribute&nbsp;f:file&nbsp;ref<br>

</code>
</p>
</div>
<div class="blockquote">
<blockquote class="blockquote">
<p></p>
</blockquote>
</div>
<p>
				
<span class="emphasis"><em>fopen</em></span> expects a 
				<span class="emphasis"><em>FILE *</em></span>. 
				<span class="emphasis"><em>f:file ref</em></span> declares a variable 
				<span class="emphasis"><em>f</em></span> from type reference to 
				<span class="emphasis"><em>file</em></span>, which is a pointer to 
				<span class="emphasis"><em>FILE</em></span>.
			</p>
</div>
<div class="section" title="Generate, build and run the model">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Generatebuildandrunthemodel"></a>Generate, build and run the model</h2>
</div>
</div>
</div>
<p>Before you can run the model you should copy one of the generated C source files into the project folder and name it 
				<span class="emphasis"><em>test.txt</em></span>. 
			</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC07.png"></div>
<p>
			
</p>
<p>Generate, build and run the model.</p>
<p>Your output should start like this:</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/036-RemoveCommentC08.png"></div>
<p>
			
</p>
</div>
<div class="section" title="Summary">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Summary5"></a>Summary</h2>
</div>
</div>
</div>
<p>This tutorial should help you to train the necessary steps to create a C model. By the way you have seen how to create your own type system for a real embedded project. An additional aspect was to show how simple it is to separate different aspects of the required functionality by the use of actors and protocols and make them reusable.</p>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;12.&nbsp;ROOM Concepts">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="ROOMConcepts"></a>Chapter&nbsp;12.&nbsp;ROOM Concepts</h2>
</div>
</div>
</div>
<p>This chapter gives an overview over the ROOM language elements and their textual and graphical notation.
			The formal ROOM grammar based on Xtext (EBNF) you can find here: 
			<a class="ulink" href="http://git.eclipse.org/c/etrice/org.eclipse.etrice.git/tree/plugins/org.eclipse.etrice.core.room/src/org/eclipse/etrice/core/Room.xtext" target="_new">ROOM Grammar</a>
		
</p>
<div class="section" title="Actors">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Actors"></a>Actors</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description"></a>Description</h3>
</div>
</div>
</div>
<p>The actor is the basic structural building block for building systems with ROOM. An actor can be refined hierarchically and thus can be of arbitrarily large scope. Ports define the interface of an actor. An Actor can also have a behavior usually defined by a finite state machine.</p>
</div>
<div class="section" title="Motivation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Motivation"></a>Motivation</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Actors enable the construction of hierarchical structures by composition and layering</p>
</li>
<li class="listitem">
<p>Actors have their own logical thread of execution</p>
</li>
<li class="listitem">
<p>Actors can be freely deployed</p>
</li>
<li class="listitem">
<p>Actors define potentially reusable blocks</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation"></a>Notation</h3>
</div>
</div>
</div>
<table title="Actor Class Notation" frame="box" border="2" cellpadding="3" cellspacing="0" id="N10BD7">
<tr>
							
<td align="center">
					<span class="bold"><strong>Element</strong></span></td>
							<td align="center">
					<span class="bold"><strong>Graphical Notation</strong></span></td>
							<td align="center">
					<span class="bold"><strong>Textual Notation</strong></span></td>
						
</tr>
<tr>
							
<td>ActorClass</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-ActorClassNotation.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-ActorClassTextualNotation.png"></div>
</td>
						
</tr>
<tr>
							
<td>ActorRef</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-ActorReferenceNotation.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-ActorReferenceTextualNotation.png"></div>
</td>
						
</tr>
</table>
<p>					 
				
</p>
</div>
<div class="section" title="Details">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Details"></a>Details</h3>
</div>
</div>
</div>
<div class="section" title="Actor Classes, Actor References, Ports and Bindings">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ActorClassesActorReferencesPortsandBindings"></a>Actor Classes, Actor References, Ports and Bindings</h4>
</div>
</div>
</div>
<p>An 
						<span class="bold"><strong>ActorClass</strong></span> defines the type (or blueprint) of an actor. Hierarchies are built by ActorClasses that contain 
						<span class="bold"><strong>ActorReferences</strong></span> which have another ActorClass as type. The interface of an ActorClass is always defined by Ports. The ActorClass can also contain Attributes, Operations and a finite state machine. 
					</p>
<p>
						
<span class="bold"><strong>External Ports</strong></span> define the external interface of an actor and are defined in the 
						<span class="bold"><strong>Interface</strong></span> section of the ActorClass.
					</p>
<p>
						
<span class="bold"><strong>Internal Ports</strong></span> define the internal interface of an actor and are defined in the 
						<span class="bold"><strong>Structure</strong></span> section of the ActorClass.
					</p>
<p>
						
<span class="bold"><strong>Bindings</strong></span> connect Ports inside an ActorClass.
					</p>
<p>Example:</p>
<table title="Actor Class Example" frame="box" border="2" cellpadding="3" cellspacing="0" id="N10C5C">
<tr>
								
<td align="center">
						<span class="bold"><strong>Graphical Notation</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Textual Notation</strong></span></td>
							
</tr>
<tr>
								
<td>
						
<div class="mediaobject">
<img src="images/040-ActorClass.png"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-ActorClassExampleTextualNotation.png"></div>
</td>
							
</tr>
</table>
<p>						 
					
</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="emphasis"><em>ActorClass1</em></span> contains two ActorReferences (of ActorClass2 and ActorClass3)
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>port1</em></span> is a 
								<span class="bold"><strong>External End Port</strong></span>. Since it connects external Actors with the behavior of the ActorClass, it is defined in the 
								<span class="bold"><strong>Interface</strong></span> section and the 
								<span class="bold"><strong>Structure</strong></span> section of the ActorClass.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>port2</em></span> and 
								<span class="emphasis"><em>port3</em></span> are 
								<span class="bold"><strong>Internal End Ports</strong></span> and can only be connected to the ports of contained ActorReferences. Internal End Ports connect the Behavior of an ActorClass with its contained ActorReferences.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>port4</em></span> is a relay port and connects external Actors to contained ActorReferences. This port can not be accessed by the behavior of the ActorClass.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="emphasis"><em>port5</em></span> through 
								<span class="emphasis"><em>port9</em></span> are Ports of contained ActorReferences. 
								<span class="emphasis"><em>port8</em></span> and 
								<span class="emphasis"><em>port9</em></span> can communicate without interference with the containing ActorClass.
							</p>
</li>
<li class="listitem">
<p>
								
<span class="bold"><strong>Bindings</strong></span> can connect ports of the ActorClass and its contained ActorReferences. 
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Attributes">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Attributes"></a>Attributes</h4>
</div>
</div>
</div>
<p>Attributes are part of the Structure of an ActorClass. They can be of a PrimitiveType or a DataClass.</p>
<p>Example:</p>
<p>
						
</p>
<div class="mediaobject">
<img src="images/040-ActorClassAttributes.png"></div>
<p>
					
</p>
</div>
<div class="section" title="Operations">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Operations"></a>Operations</h4>
</div>
</div>
</div>
<p>Operations are part of the Behavior of an ActorClass.  Arguments and return values can be of a PrimitiveType or a DataClass. DataClasses can be passed by value (implicit) or by reference (keyword 
						<span class="bold"><strong>ref</strong></span>).
					</p>
<p>Example:</p>
<p>
						
</p>
<div class="mediaobject">
<img src="images/040-ActorClassOperations.png"></div>
<p>
					
</p>
</div>
</div>
</div>
<div class="section" title="Protocols">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Protocols"></a>Protocols</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description2"></a>Description</h3>
</div>
</div>
</div>
<p>A ProtocolClass defines a set of incoming and outgoing messages that can be exchanged between two ports.
					The exact semantics of a message is defined by the execution model.</p>
</div>
<div class="section" title="Motivation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Motivation2"></a>Motivation</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>ProtocolClasses provide a reusable interface specification for ports</p>
</li>
<li class="listitem">
<p>ProtocolClasses can optionally specify valid message exchange sequences</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation2"></a>Notation</h3>
</div>
</div>
</div>
<p>ProtocolClasses have only textual notation. 
					The example defines a ProtocolClass with 2 incoming and two outgoing messages. Messages can have data attached. The data can be of a primitive type (e.g. int32, float64, ...) or a DataClass.</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/040-ProtocolClassTextualNotation.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Ports">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Ports"></a>Ports</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description3"></a>Description</h3>
</div>
</div>
</div>
<p>Ports are the only interfaces of actors. A port has always a protocol assigned. 
					Service Access Points (SAP) and Service Provision Points (SPP) are specialized ports that are used to define layering.</p>
</div>
<div class="section" title="Motivation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Motivation3"></a>Motivation</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>Ports decouple interface definition (Protocols) from interface usage</p>
</li>
<li class="listitem">
<p>Ports decouple the logical interface from the transport </p>
</li>
</ul>
</div>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation3"></a>Notation</h3>
</div>
</div>
</div>
<div class="section" title="Class Ports">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ClassPorts"></a>Class Ports</h4>
</div>
</div>
</div>
<p>These symbols can only appear on the border of an actor class symbol. </p>
<p>Ports that define an external interface of the ActorClass, are defined in the 
						<span class="emphasis"><em>Interface</em></span>. Ports that define an internal interface are defined in the 
						<span class="emphasis"><em>Structure</em></span> (e.g. internal ports).
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<span class="bold"><strong>External End Ports</strong></span> are defined in the Interface and the Structure
							</p>
</li>
<li class="listitem">
<p>
								
<span class="bold"><strong>Internal End Ports</strong></span> are only defined in the Structure
							</p>
</li>
<li class="listitem">
<p>
								
<span class="bold"><strong>Relay Ports</strong></span> are only defined in the Interface
							</p>
</li>
<li class="listitem">
<p>
								
<span class="bold"><strong>End Ports</strong></span> are always connected to the internal behavior of the ActorClass
							</p>
</li>
<li class="listitem">
<p>
								
<span class="bold"><strong>Replicated Ports</strong></span> can be defined with a fixed replication factor ( e.g. 
								<span class="emphasis"><em>Port port18 [ 5 ]: ProtocolClass1</em></span> ) or a variable replication factor (e.g. 
								<span class="emphasis"><em>Port port18[ * ]: ProtocolClass1</em></span> )
							</p>
</li>
</ul>
</div>
<table title="Class Port Notation" frame="box" border="2" cellpadding="3" cellspacing="0" id="N10D63">
<tr>
								
<td align="center">
						<span class="bold"><strong>Element</strong></span></td>
								<td align="center" width="15%">
						<span class="bold"><strong>Graphical Notation</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Textual Notation</strong></span></td>
							
</tr>
<tr>
								
<td>Class End Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ClassEndPort.png"></div>
</td>
								<td>
									
						<span class="bold"><strong>External Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ClassEndPortTextual.png"></div>
									
						
<span class="bold"><strong>Internal Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ClassEndPortInternalTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Conjugated Class End Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedClassEndPort.png"></div>
</td>
								<td>
									
						<span class="bold"><strong>External Conjugated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedClassEndPortTextual.png"></div>
									
						
<span class="bold"><strong>Internal Conjugated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedClassEndPortInternalTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Class Relay Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ClassRelayPort.png"></div>
</td>
								<td>
									
						
<div class="mediaobject">
<img src="images/040-ClassRelayPortTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Conjugated Class Relay Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedClassRelayPort.png"></div>
</td>
								<td>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedClassRelayPortTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Replicated Class End Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ReplicatedClassEndPort.png"></div>
</td>
								<td>
									
						<span class="bold"><strong>External Replicated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ReplicatedClassEndPortTextual.png"></div>
									
						
<span class="bold"><strong>Internal Replicated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ReplicatedClassEndPortInternalTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Conjugated Replicated Class End Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedClassEndPort.png"></div>
</td>
								<td>
									
						<span class="bold"><strong>External Conjugated Replicated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedClassEndPortTextual.png"></div>
									
						
<span class="bold"><strong>Internal Conjugated Replicated Class End Port:</strong></span>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedClassEndPortInternalTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Replicated Class Relay Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ReplicatedClassRelayPort.png"></div>
</td>
								<td>
									
						
<div class="mediaobject">
<img src="images/040-ReplicatedClassRelayPortTextual.png"></div>
								
</td>
							
</tr>
<tr>
								
<td>Conjugated Replicated Class Relay Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedClassRelayPort.png"></div>
</td>
								<td>
									
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedClassRelayPortTextual.png"></div>
								
</td>
							
</tr>
</table>
<p>
					
</p>
</div>
<div class="section" title="Reference Ports">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ReferencePorts"></a>Reference Ports</h4>
</div>
</div>
</div>
<p>These symbols can only appear on the border of an ActorReference symbol. Since the type of port is defined in the ActorClass, no textual notation for the Reference Ports exists.</p>
<table title="Title" frame="box" border="2" cellpadding="3" cellspacing="0" id="N10E9B">
<tr>
								
<td align="center">
						<span class="bold"><strong>Element</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Graphical Notation</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Textual Notation</strong></span></td>
							
</tr>
<tr>
								
<td>Reference Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ReferencePort.png"></div>
</td>
								<td align="center">
						<span class="emphasis"><em>implicit</em></span></td>
							
</tr>
<tr>
								
<td>Conjugated Reference Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedReferencePort.png"></div>
</td>
								<td align="center">
						<span class="emphasis"><em>implicit</em></span></td>
							
</tr>
<tr>
								
<td>Replicated Reference Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ReplicatedReferencePort.png"></div>
</td>
								<td align="center">
						<span class="emphasis"><em>implicit</em></span></td>
							
</tr>
<tr>
								
<td>Conjugated Replicated Reference Port</td>
								<td align="center">
						
<div class="mediaobject">
<img src="images/040-ConjugatedReplicatedReferencePort.png"></div>
</td>
								<td align="center">
						<span class="emphasis"><em>implicit</em></span></td>
							
</tr>
</table>
<p>
					
</p>
</div>
</div>
</div>
<div class="section" title="DataClass">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="DataClass"></a>DataClass</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description4"></a>Description</h3>
</div>
</div>
</div>
<p>The DataClass enables the modeling of hierarchical complex datatypes and operations on them. The DataClass is the equivalent to a Class in languages like Java or C++, but has less features. The content of a DataClass can always be sent via message between actors (defined as message data in ProtocolClass).</p>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation4"></a>Notation</h3>
</div>
</div>
</div>
<p>Example: DataClass using PrimitiveTypes</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/040-DataClass1.png"></div>
<p>
				
</p>
<p>Example: DataClass using other DataClasses:</p>
<p>
					
</p>
<div class="mediaobject">
<img src="images/040-DataClass2.png"></div>
<p>
				
</p>
</div>
</div>
<div class="section" title="Layering">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Layering2"></a>Layering</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description5"></a>Description</h3>
</div>
</div>
</div>
<p>In addition to the Actor containment hierarchies, Layering provides another method to hierarchically structure a software system. Layering and actor hierarchies with port to port connections can be mixed on every level of granularity.</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>an ActorClass can define a Service Provision Point (SPP) to publish a specific service, defined by a ProtocolClass</p>
</li>
<li class="listitem">
<p>an ActorClass can define a Service Access Point (SAP) if it needs a service, defined by a ProtocolClass</p>
</li>
<li class="listitem">
<p>for a given Actor hierarchy, a LayerConnection defines which SAP will be satisfied by (connected to) which SPP</p>
</li>
</ol>
</div>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation5"></a>Notation</h3>
</div>
</div>
</div>
<table title="Title" frame="box" border="2" cellpadding="3" cellspacing="0" id="N10F5E">
<tr>
							
<td align="center">
					<span class="bold"><strong>Description</strong></span></td>
							<td align="center">
					<span class="bold"><strong>Graphical Notation</strong></span></td>
							<td align="center">
					<span class="bold"><strong>Textual Notation</strong></span></td>
						
</tr>
<tr>
							
<td>The Layer Connections in this model define which services are provided by the 
					<span class="emphasis"><em>ServiceLayer</em></span>  (
					<span class="emphasis"><em>digitalIO</em></span> and 
					<span class="emphasis"><em>timer</em></span>)</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringModel.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringModelTextual.png"></div>
</td>
						
</tr>
<tr>
							
<td>The implementation of the services (SPPs) can be delegated to sub actors. In this case the actor 
					<span class="emphasis"><em>ServiceLayer</em></span> relays (delegates) the implementation services 
					<span class="emphasis"><em>digitalIO</em></span> and 
					<span class="emphasis"><em>timer</em></span> to sub actors</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringServiceLayer.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringServiceLayerTextual.png"></div>
</td>
						
</tr>
<tr>
							
<td>Every Actor inside the 
					<span class="emphasis"><em>ApplicationLayer</em></span> that contains an SAP with the same Protocol as 
					<span class="emphasis"><em>timer</em></span> or 
					<span class="emphasis"><em>digitalIO</em></span> will be connected to the specified SPP</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringApplicationLayer.png"></div>
</td>
							<td>
					
<div class="mediaobject">
<img src="images/040-LayeringApplicationLayerTextual.png"></div>
</td>
						
</tr>
</table>
<p>
				
</p>
</div>
</div>
<div class="section" title="Finite State Machines">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="FiniteStateMachines"></a>Finite State Machines</h2>
</div>
</div>
</div>
<div class="section" title="Description">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Description6"></a>Description</h3>
</div>
</div>
</div>
<p>Definition from 
					<a class="ulink" href="http://en.wikipedia.org/wiki/Finite-state_machine" target="_new">Wikipedia</a>:
				</p>
<div class="blockquote">
<blockquote class="blockquote">
<p>
						A finite-state machine (FSM) or finite-state automaton (plural: automata), or simply a state machine, is a mathematical model used to design computer programs and digital logic circuits. It is conceived as an abstract machine that can be in one of a finite number of states. The machine is in only one state at a time; the state it is in at any given time is called the current state. It can change from one state to another when initiated by a triggering event or condition, this is called a transition. A particular FSM is defined by a list of the possible states it can transition to from each state, and the triggering condition for each transition.</p>
</blockquote>
</div>
<p>In ROOM each actor class can implement its behavior using a state machine. Events occurring at the end ports of an actor will be forwarded to and processed by the state machine. Events possibly trigger state transitions.</p>
</div>
<div class="section" title="Motivation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Motivation4"></a>Motivation</h3>
</div>
</div>
</div>
<p>For event driven systems a finite state machine is ideal for processing the stream of events. Typically during processing new events are produced which are sent to peer actors.</p>
<p>We distinguish flat and hierarchical state machines.</p>
</div>
<div class="section" title="Notation">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Notation6"></a>Notation</h3>
</div>
</div>
</div>
<div class="section" title="Flat Finite State Machine">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="FlatFiniteStateMachine"></a>Flat Finite State Machine</h4>
</div>
</div>
</div>
<p>The simpler flat finite state machines are composed of the following elements:</p>
<table title="Title" frame="box" border="2" cellpadding="3" cellspacing="0" id="N1100E">
<tr>
								
<td align="center">
						<span class="bold"><strong>Description</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Graphical Notation</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Textual Notation</strong></span></td>
							
</tr>
<tr>
								
<td>State</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-State.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-StateTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>InitialPoint</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-InitialPoint.jpg"></div>
</td>
								<td>
						<span class="emphasis"><em>implicit</em></span></td>
							
</tr>
<tr>
								
<td>TransitionPoint</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-TransitionPoint.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-TransitionPointTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>ChoicePoint</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-ChoicePoint.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-ChoicePointTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>Initial Transition</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-InitialTransition.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-InitialTransitionTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>Triggered Transition</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-TriggeredTransition.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-TriggeredTransitionTextual.jpg"></div>
</td>
							
</tr>
</table>
<p>
					
</p>
</div>
<div class="section" title="Hierarchical Finite State Machine">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="HierarchicalFiniteStateMachine"></a>Hierarchical Finite State Machine</h4>
</div>
</div>
</div>
<p>The hierarchical finite state machine adds the notion of a sub state machine nested in a state.
						A few modeling elements are added to the set listed above:</p>
<table title="Title" frame="box" border="2" cellpadding="3" cellspacing="0" id="N110CD">
<tr>
								
<td align="center">
						<span class="bold"><strong>Description</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Graphical Notation</strong></span></td>
								<td align="center">
						<span class="bold"><strong>Textual Notation</strong></span></td>
							
</tr>
<tr>
								
<td>State with sub state machine</td>
								<td>Parent State
								
						<div class="mediaobject">
<img src="images/040-StateWithSubFSM.jpg"></div>
								Sub state machine
								
						<div class="mediaobject">
<img src="images/040-SubFSM.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-StateWithSubFSMTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>Entry Point</td>
								<td>In sub state machine
								
						<div class="mediaobject">
<img src="images/040-EntryPoint.jpg"></div>
								On parent state
								
						<div class="mediaobject">
<img src="images/040-EntryPointRef.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-EntryPointTextual.jpg"></div>
</td>
							
</tr>
<tr>
								
<td>Exit Point</td>
								<td>In sub state machine
								
						<div class="mediaobject">
<img src="images/040-ExitPoint.jpg"></div>
								On parent state
								
						<div class="mediaobject">
<img src="images/040-ExitPointRef.jpg"></div>
</td>
								<td>
						
<div class="mediaobject">
<img src="images/040-ExitPointTextual.jpg"></div>
</td>
							
</tr>
</table>
<p>
					
</p>
</div>
</div>
<div class="section" title="Examples">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Examples"></a>Examples</h3>
</div>
</div>
</div>
<div class="section" title="Example of a flat finite state machine:">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Exampleofaflatfinitestatemachine"></a>Example of a flat finite state machine:</h4>
</div>
</div>
</div>
<p>
						
</p>
<div class="mediaobject">
<img src="images/040-FlatFSM.jpg"></div>
<p>
					
</p>
</div>
<div class="section" title="Example of a hierarchical finite state machine:">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Exampleofahierarchicalfinitestatemachine"></a>Example of a hierarchical finite state machine:</h4>
</div>
</div>
</div>
<p>Top level

						</p>
<div class="mediaobject">
<img src="images/040-HierarchicalFSMTop.jpg"></div>
<p>
					
</p>
<p>Sub state machine of Initializing

						</p>
<div class="mediaobject">
<img src="images/040-HierarchicalFSMInitializing.jpg"></div>
<p>
					
</p>
<p>Sub state machine of Running

						</p>
<div class="mediaobject">
<img src="images/040-HierarchicalFSMRunning.jpg"></div>
<p>
					
</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter&nbsp;13.&nbsp;eTrice Developer&rsquo;s Reference">
<div class="titlepage">
<div>
<div>
<h2 class="title">
<a name="eTriceDevelopersReference"></a>Chapter&nbsp;13.&nbsp;eTrice Developer&rsquo;s Reference</h2>
</div>
</div>
</div>
<div class="section" title="Architecture">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="Architecture"></a>Architecture</h2>
</div>
</div>
</div>
<p>The basic components of eTrice are depicted in the following diagram.</p>
<p>
				
</p>
<div class="mediaobject">
<img src="images/components.jpg"></div>
<p>
			
</p>
<p>Additional to that the eTrice project comprises runtime libraries and unit tests which are treated in subsequent sections.</p>
<div class="section" title="Editor and Generator Components">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="EditorandGeneratorComponents"></a>Editor and Generator Components</h3>
</div>
</div>
</div>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>core</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>core.coom is an Xtext based language called Room. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.core.room</em></span>. Room is the basic modeling language of eTrice.
								</p>
</li>
<li class="listitem">
<p>core.config is an Xtext based language called Config. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.core.config</em></span>. Config is a language designed for the data configuration of model elements. E.g. class and instance attributes can be specified.
								</p>
</li>
<li class="listitem">
<p>core.genmodel is an EMF based aggregation layer for Room models. It consists of the plugin 
									<span class="emphasis"><em>org.eclipse.etrice.core.genmodel</em></span>. a Room model can be transformed into a genmodel which allows easy access to implicit relations of the Room model.
								</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>ui</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>textual</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="square">
<li class="listitem">
<p>room.ui is the ui counterpart of core.room.  It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.core.room.ui</em></span>. This plug-in realizes IDE concepts like content assist, error markers and navigation by hyper links for the Room language.
										</p>
</li>
<li class="listitem">
<p>config.ui is the ui counterpart of core.config.  It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.core.config.ui</em></span>. This plug-in realizes IDE concepts like content assist, error markers and navigation by hyper links for the Config language.
										</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>graphical</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="square">
<li class="listitem">
<p>ui.common is a set of common code for the two diagram editors. It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.ui.common</em></span>.
										</p>
</li>
<li class="listitem">
<p>ui.commands encapsulates some commands related to the navigation between eTrice editors. It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.ui.commands</em></span>.
										</p>
</li>
<li class="listitem">
<p>ui.structure is the Graphiti based editor for the Actor structure. It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.ui.structure</em></span>.
										</p>
</li>
<li class="listitem">
<p>ui.behavior is the Graphiti based editor for the Actor behavior. It consists of the plug-in 
											<span class="emphasis"><em>org.eclipse.etrice.ui.behavior</em></span>.
										</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>generators</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="circle">
<li class="listitem">
<p>generator is a set of general classes and language independent parts of all generators. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.generator</em></span>.
								</p>
</li>
<li class="listitem">
<p>generator.c is the generator for the ANSI-C target language. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.generator.c</em></span>.
								</p>
</li>
<li class="listitem">
<p>generator.java is the generator for the Java target language. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.generator.java</em></span>.
								</p>
</li>
<li class="listitem">
<p>generator.doc is the generator for the model documentation. It consists of the plug-in 
									<span class="emphasis"><em>org.eclipse.etrice.generator.doc</em></span>.
								</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="section" title="Runtimes">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="Runtimes"></a>Runtimes</h3>
</div>
</div>
</div>
<p>Currently eTrice ships with a C and a Java runtime. The runtimes are libraries written in the target language against which the generated code is compiled.</p>
</div>
<div class="section" title="Unit Tests">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="UnitTests"></a>Unit Tests</h3>
</div>
</div>
</div>
<p>Most plug-ins and other parts of the code have related unit tests.</p>
</div>
</div>
<div class="section" title="Component Overview">
<div class="titlepage">
<div>
<div>
<h2 class="title" style="clear: both">
<a name="ComponentOverview"></a>Component Overview</h2>
</div>
</div>
</div>
<div class="section" title="Room Language Overview">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="RoomLanguageOverview"></a>Room Language Overview</h3>
</div>
</div>
</div>
<p>We assume that the reader is familiar with the Xtext concepts. So we concentrate on the details of our implementation that are worth to be pointed out.</p>
<div class="section" title="Model Tweaks">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ModelTweaks"></a>Model Tweaks</h4>
</div>
</div>
</div>
<p>The Room EMF model is inferred from the grammar. However, this powerful mechanism has to be tweaked at some places.
						This is done in the 
						<span class="emphasis"><em>/org.eclipse.etrice.core.room/src/org/eclipse/etrice/core/RoomPostprocessor.ext</em></span> which is written in the legacy Xtend language.
					</p>
<p>The following parts of the model are changed or added:</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>the default 
								<code class="code">multiplicity</code> of the 
								<code class="code">Port</code> is set to 1
							</p>
</li>
<li class="listitem">
<p>the operation 
								<code class="code">isReplicated</code> is added to the 
								<code class="code">Port</code>
							
</p>
</li>
<li class="listitem">
<p>the default 
								<code class="code">size</code> of the 
								<code class="code">ActorRef</code> is set to 1
							</p>
</li>
<li class="listitem">
<p>an operation 
								<code class="code">getName</code> is add to the 
								<code class="code">State</code> class
							</p>
</li>
<li class="listitem">
<p>an operation 
								<code class="code">getName</code> is add to the 
								<code class="code">StateGraphItem</code> class
							</p>
</li>
<li class="listitem">
<p>an operation 
								<code class="code">getGeneralProtocol</code> is added to the 
								<code class="code">InterfaceItem</code>
							
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Imports by URI Using Namespaces">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ImportsbyURIUsingNamespaces"></a>Imports by URI Using Namespaces</h4>
</div>
</div>
</div>
<p>The import mechanism employed is based on URIs. This is configured for one part in the GenerateRoom.mwe2 model workflow by setting the fragments ImportURIScopingFragment and ImportUriValidator). For the other part it is configured in the Guice modules by binding</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">PlatformRelativeUriResolver</code> &mdash; this class tries to convert the import URI into a platform relative URI. It also replaces environment variables written in ${} with their respective values.
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">ImportedNamespaceAwareLocalScopeProvider</code> &mdash; this is a standard scope provider which is aware of namespaces
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">GlobalNonPlatformURIEditorOpener</code> &mdash; this editor opener tries to convert general URIs into platform URIs because editors can only open platform URIs
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">ImportAwareHyperlinkHelper</code> &mdash; turns the URI part of an import into a navigatable hyper link
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Naming">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Naming"></a>Naming</h4>
</div>
</div>
</div>
<p>Two classes provide object names used for link resolution and for labels.
						The 
						<code class="code">RoomNameProvider</code> provides frequently used name strings, some of them are hierarchical like State paths.
						The 
						<code class="code">RoomFragmentProvider</code> serves a more formal purpose since it provides a link between EMF models (as used by the diagram editors) and the textual model representation used by Xtext.
					</p>
</div>
<div class="section" title="Helpers">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Helpers"></a>Helpers</h4>
</div>
</div>
</div>
<p>The 
						<code class="code">RoomHelpers</code> class provides a great deal of static methods that help retrieve frequently used information from the model.
						Among many, many others
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">getAllEndPorts(ActorClass)</code> - returns a list of all end ports of an actor class including inherited ones
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getInheritedActionCode(Transition, ActorClass)</code> - get the inherited part of a transition&rsquo;s action code
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getSignature(Operation)</code> - returns a string representing the operation signature suited for a label
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Validation">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Validation"></a>Validation</h4>
</div>
</div>
</div>
<p>Validation is used from various places. Therefore all validation code is accumulated in the 
						<code class="code">ValidationUtil</code> class. All methods are static and many of them return a Result object which contains information about the problem detected as well as object and feature as suited for most validation purposes.
					</p>
</div>
</div>
<div class="section" title="Config Language Overview">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="ConfigLanguageOverview"></a>Config Language Overview</h3>
</div>
</div>
</div>
<div class="section" title="Model Tweaks">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ModelTweaks2"></a>Model Tweaks</h4>
</div>
</div>
</div>
<p>A couple of operations are added to the ConfigModel</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">getActorClassConfigs</code>
							
</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getActorInstanceConfigs</code>
							
</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getProtocolClassConfigs</code>
							
</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getSubSystemConfigs</code>
							
</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Imports by URI Using Namespaces">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="ImportsbyURIUsingNamespaces2"></a>Imports by URI Using Namespaces</h4>
</div>
</div>
</div>
<p>Imports are treated similar than in the 
						<a class="link" href="#ImportsbyURIUsingNamespaces" title="Imports by URI Using Namespaces">Room language</a>.
					</p>
</div>
<div class="section" title="Util">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="Util"></a>Util</h4>
</div>
</div>
</div>
<p>A set of static utility methods can be found in the 
						<code class="code">ConfigUtil</code> class.
					</p>
</div>
</div>
<div class="section" title="Aggregation Layer Overview">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="AggregationLayerOverview"></a>Aggregation Layer Overview</h3>
</div>
</div>
</div>
<p>The eTrice Generator Model (genmodel) serves as an aggregation layer. Its purpose is to allow easy access to information which is implicitly contained in the Room model but not simple to retrieve.
					Examples of this are the state machine with inherited items or a list of all triggers active at a state in the order in which they will be evaluated or the actual peer port of an end port (following bindings through relay ports).</p>
<p>The Generator Model is created from a list of Room models by a call of the</p>
<div class="literallayout">
<p>
<code class="code">createGeneratorModel(List&lt;RoomModel&gt;,&nbsp;boolean)<br>

</code>
</p>
</div>
<p>method of the 
					<code class="code">GeneratorModelBuilder</code> class.
				</p>
<p>The 
					<code class="code">Root</code> object of the resulting Generator Model provides chiefly two things:
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>a tree of instances starting at each 
							<code class="code">SubSystem</code> with representations of each 
							<code class="code">ActorInstance</code> and 
							<code class="code">PortInstance</code>
						
</p>
</li>
<li class="listitem">
<p>for each 
							<code class="code">ActorClass</code> a corresponding 
							<code class="code">ExpandedActorClass</code> with an explicit state machine containing all inherited state graph items
						</p>
</li>
</ul>
</div>
<div class="section" title="The Instance Model">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TheInstanceModel"></a>The Instance Model</h4>
</div>
</div>
</div>
<p>The instance model allows easy access to instances including their unique paths and object IDs. Also it is possible to get a list of all peer port instances for each port instance without having to bother about port and actor replication.</p>
</div>
<div class="section" title="The Expanded Actor Class">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TheExpandedActorClass"></a>The Expanded Actor Class</h4>
</div>
</div>
</div>
<p>The expanded actor class contains, as already mentioned, the complete state machine of the actor class. This considerably simplifies the task of state machine generation. Note that the generated code always contains the complete state machine of an actor. I.e. no target language inheritance is used to implement the state machine inheritance.
						Furthermore the 
						<code class="code">ExpandedActorClass</code> gives access to
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">getIncomingTransitions(StateGraphNode)</code> &mdash; the set of incoming transition of a 
								<code class="code">StateGraphNode</code> (
								<code class="code">State</code>, 
								<code class="code">ChoicePoint</code> or 
								<code class="code">TransitionPoint</code>)
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getOutgoingTransitions(StateGraphNode)</code> &mdash; the set of outgoing transition of a 
								<code class="code">StateGraphNode</code>
							
</p>
</li>
<li class="listitem">
<p>
								
<code class="code">getActiveTriggers(State)</code> &mdash; the triggers that are active in this 
								<code class="code">State</code> in the order they are evaluated
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Transition Chains">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TransitionChains"></a>Transition Chains</h4>
</div>
</div>
</div>
<p>By transition chains we denote a connected subset of the (hierarchical) state machine that starts with a transition starting at a state and continues over transitional state graph nodes (choice points and transition points) and continuation transitions until a state is reached. In general a transition chain starts at one state and ends in several states (the chain may branch in choice points).
						A 
						<code class="code">TransitionChain</code> of a transition is retrieved by a call of 
						<code class="code">getChain(Transition)</code> of the 
						<code class="code">ExpandedActorClass</code>.
						The 
						<code class="code">TransitionChain</code> accepts an 
						<code class="code">ITransitionChainVisitor</code> which is called along the chain to generate the action codes of involved transitions and the conditional statements arising from the involved choice points. 
					</p>
</div>
</div>
<div class="section" title="Generator Overview">
<div class="titlepage">
<div>
<div>
<h3 class="title">
<a name="GeneratorOverview"></a>Generator Overview</h3>
</div>
</div>
</div>
<p>There is one plug-in that consists of base classes and some generic generator parts which are re-used by all language specific generators</p>
<div class="section" title="Base Classes and Interfaces">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="BaseClassesandInterfaces"></a>Base Classes and Interfaces</h4>
</div>
</div>
</div>
<p>We just want to mention the most important classes and interfaces.</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>
								
<code class="code">ITranslationProvider</code> &mdash; this interface is used by the 
								<code class="code">DetailCodeTranslator</code> for the language dependent translation of e.g. port.message() notation in detail code
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">AbstractGenerator</code> &mdash; concrete language generators should derive from this base class
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">DefaultTranslationProvider</code> &mdash; a stub implementation of 
								<code class="code">ITranslationProvider</code> from which clients may derive
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">Indexed</code> &mdash; provides an indexed iterable of a given iterable
							</p>
</li>
<li class="listitem">
<p>
								
<code class="code">GeneratorBaseModule</code> &mdash; a Google Guice module that binds a couple of basic services. Concrete language generators should use a module that derives from this
							</p>
</li>
</ul>
</div>
</div>
<div class="section" title="Generic Generator Parts">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="GenericGeneratorParts"></a>Generic Generator Parts</h4>
</div>
</div>
</div>
<p>The generic generator parts provide code generation blocks on a medium granularity. The language dependent top level generators embed those blocks in a larger context (file, class, ...). Language dependent low level constructs are provided by means of an 
						<code class="code">ILanguageExtension</code>. This extension and other parts of the generator be configured using Google Guice dependency injection.
					</p>
<div class="section" title="GenericActorClassGenerator">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="GenericActorClassGenerator"></a>GenericActorClassGenerator</h5>
</div>
</div>
</div>
<p>The 
							<code class="code">GenericActorClassGenerator</code> generates constants for the interface items of a actor. Those constants are used by the generated state machine.
						</p>
</div>
<div class="section" title="GenericProtocolClassGenerator">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="GenericProtocolClassGenerator"></a>GenericProtocolClassGenerator</h5>
</div>
</div>
</div>
<p>The 
							<code class="code">GenericProtocolClassGenerator</code> generates message ID constants for a protocol.
						</p>
</div>
<div class="section" title="GenericStateMachineGenerator">
<div class="titlepage">
<div>
<div>
<h5 class="title">
<a name="GenericStateMachineGenerator"></a>GenericStateMachineGenerator</h5>
</div>
</div>
</div>
<p>The 
							<code class="code">GenericStateMachineGenerator</code> generates the complete state machine implementation. The skeleton of the generated code is
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
<li class="listitem">
<p>definition state ID constants</p>
</li>
<li class="listitem">
<p>definition of transition chain constants</p>
</li>
<li class="listitem">
<p>definition of trigger constants</p>
</li>
<li class="listitem">
<p>entry, exit and action code methods</p>
</li>
<li class="listitem">
<p>the 
									<code class="code">exitTo</code> method 
								</p>
</li>
<li class="listitem">
<p>the 
									<code class="code">executeTransitionChain</code> method
								</p>
</li>
<li class="listitem">
<p>the 
									<code class="code">enterHistory</code> method
								</p>
</li>
<li class="listitem">
<p>the 
									<code class="code">executeInitTransition</code> method
								</p>
</li>
<li class="listitem">
<p>the 
									<code class="code">receiveEvent</code> method
								</p>
</li>
</ul>
</div>
<p>The state machine works as follows. The main entry method is the 
							<code class="code">receiveEvent</code> method. This is the case for both, data driven (polled) and event driven state machines. Then a number of nested switch/case statements evaluates trigger conditions and derives the transition chain that is executed. If a trigger fires then the 
							<code class="code">exitTo</code> method is called to execute all exit codes involved. Then the transition chain action codes are executed and the choice point conditions are evaluated in the 
							<code class="code">executeTransitionChain</code> method. Finally the history of the state where the chain ends is entered and all entry codes are executed by 
							<code class="code">enterHistory</code>.
						</p>
</div>
</div>
<div class="section" title="The Java Generator">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TheJavaGenerator"></a>The Java Generator</h4>
</div>
</div>
</div>
<p>The Java generator employs the generic parts of the generator. The 
						<code class="code">JavaTranslationProvider</code> is very simple and only handles the case of sending a message from a distinct replicated port: 
						<code class="code">replPort[2].message()</code>. Other cases are handled by the base class by returning the original text.
					</p>
<p>The 
						<code class="code">DataClassGen</code> uses Java inheritance for the generated data classes. Otherwise it is pretty much straight forward.
					</p>
<p>The 
						<code class="code">ProtocolClassGen</code> generates a class for the protocol with nested static classes for regular and conjugated ports and similar for replicated ports.
					</p>
<p>The 
						<code class="code">ActorClassGen</code> uses Java inheritance for the generated actor classes. So ports, SAPs and attributes and detail code methods are inherited. Not inherited is the state machine implementation.
					</p>
</div>
<div class="section" title="The ANSI-C Generator">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TheANSICGenerator"></a>The ANSI-C Generator</h4>
</div>
</div>
</div>
<p>The C generator translates data, protocol and actor classes into structs together with a set of methods that operate on them and receive a pointer to those data (called 
						<code class="code">self</code> in analogy to the implicit C++ 
						<code class="code">this</code> pointer).
						No dynamic memory allocation is employed. All actor instances are statically initialized.
						One of the design goals for the generated C code was an optimized footprint in terms of memory and performance to be able to utilize modeling with ROOM also for tiny low end micro controllers.
					</p>
</div>
<div class="section" title="The Documentation Generator">
<div class="titlepage">
<div>
<div>
<h4 class="title">
<a name="TheDocumentationGenerator"></a>The Documentation Generator</h4>
</div>
</div>
</div>
<p>The documentation generator creates documentation in LaTex format which can be converted into PDF and many other formats.</p>
</div>
</div>
</div>
</div>
</div>
</body>
</html>
