\section{HelloWorld for Java}

In this tutorial you will get a first look at a very simple \eTrice{} model. The goal is to learn the work flow of \eTrice{} and to understand a few basic features of ROOM.
\textbf{Preconditions}:
\begin{itemize}
	\item Installed JDT Eclipse
	\item Activated \emph{Build Automatically} option in Eclipse: \emph{Project -> Build Automatically}
	\item Recommended: Activate automatic resource refresh in Eclipse: \emph{Window -> Preferences -> General -> Workspace}
	\begin{itemize}
		\item \emph{Refresh using native hooks or polling}
		\item \emph{Refresh on access}
	\end{itemize}
	\item Optional: Install \href{http://trace2uml.stage.tigris.org/}{Trace2UML}, a Open Source MSC viewer
	\begin{itemize}
		\item \href{http://trace2uml.tigris.org/servlets/ProjectDocumentList?folderID=6208}{Windows download site}
		\item \href{http://apt.astade.de/}{Linux package}
	\end{itemize}
	
\end{itemize}

\subsection{Create template project}
After installation of \eTrice in Eclipse, we can use the wizard to create the template project, which is good starting point for new ROOM applications. Select the menu \emph{File -> New -> Other} (Ctrl+N) and choose \emph{eTrice Java Template Project}. Name the project \emph{TemplateModel} and press \emph{Next}. On the next page select \emph{use Eclipse JDT build} and press \emph{Finish}.

\includegraphics[width=\textwidth]{images/015-wizard.png}

This will add three projects into your workspace, the library projects \emph{runtime.java} and \emph{modellib.java} and our application project \emph{TemplateModel}. Now open the \emph{TemplateModel.room} in the model folder of our project.

\includegraphics[width=\textwidth]{images/015-after-wizard.png}

The model contains an ActorClass \emph{TopActor}, which is currently the only active actor. TopActor has a state machine that is intended to output a simple HelloWorld statement. To inspect its behavior graphically, we can open the behavior diagram by right click on \emph{Outline View -> TopActor -> Edit Behavior}. Alternatively we can place the cursor within the textual notation and press Alt+B.

\includegraphics[width=\textwidth]{images/015-open-hello-fsm.png}

The state machine has an initial transition that leads to \emph{helloState}. The state defines an entry code, which is executed during the transition. We can view the details by hovering over the state and edit the code with a double-click or right click and \emph{Edit State}.

\includegraphics[width=\textwidth]{images/015-hello-fsm.png}

\subsection{Generate and run application}

Now we are ready to translate the model into an executable application. The first step is to generate source files from the model. Therefore we run the eTrice model generator by right click on file \begin{quote}
	\emph{generate\_Template.launch -> Run As -> generate\_Template}.
\end{quote}
After that we can build and run the application by right click on file
\begin{quote}
	\emph{run\_Template\_Windows.launch -> Run As -> run\_Template\_Windows}
\end{quote}.
This will trigger the build process, carried out by CDT Eclipse and then subsequently start our application.

\begin{tabular}{cc}
	\includegraphics[width=.45\textwidth]{images/014-generate.png} & 
	\includegraphics[width=.45\textwidth]{images/014-build_run.png} \\
	1. Invoke generator & 2. Build and run application
\end{tabular}

The output of our application is logged in the Console View and it shows the "Hello World". By typing "quit", as prompt, and pressing enter, the application terminates regularly.

\includegraphics[width=\textwidth]{images/014-quit-hello-msc.png}

\input{015.2-hello-world-open-msc}




\subsection{Create a new model from scratch}

The easiest way to create a new \eTrice{} Project is to use the eclipse project wizard. From the eclipse file 
menu select \emph{File->New->Project} and create a new \emph{Empty eTrice Java Project} and name it \textbf{HelloWorld}.

\includegraphics[width=0.8\textwidth]{images/015-HelloWorld10.png}

On the second wizard page use the selected default ("Use Eclipse JDT build") and press "Finish".
The wizard creates everything that is needed to create, build and run an \eTrice{} model. The resulting 
project should look like this:

\includegraphics{images/015-HelloWorld11.png}

Within the model directory the model file \emph{HelloWorld.room} was created. Open the 
\emph{HelloWorld.room} file and delete the contents of the file. Open the content assist with Ctrl+Space 
and select \emph{RoomModel - model skeleton}.

\includegraphics[width=0.6\textwidth]{images/015-HelloWorld12.png}

Edit the template variables by typing the new names and jumping with Tab from name to name.

The resulting model code should look like this:

\begin{lstlisting}[language=ROOM]
RoomModel HelloWorld_Model {

	LogicalSystem LogSys1 {
		SubSystemRef subSysRef1: SubSysClass1
	}

	SubSystemClass SubSysClass1 {
		ActorRef actorRef1: HelloWorldTop
		LogicalThread defaultThread
	}

	ActorClass HelloWorldTop { }

}
\end{lstlisting}

The physical model has already been created for us in file model/HelloWorld.etphys.
We can just leave it as it is.

\begin{lstlisting}[language=etPhys]
PhysicalModel PhysicalModel1 {

	PhysicalSystem PhysSys1 {
		NodeRef nodeRef1 : NodeClass1
	}

	NodeClass NodeClass1 {
		runtime = RuntimeClass1
		priomin = -10
		priomax = 10
		DefaultThread PhysicalThread1 {
			execmode = mixed
			interval = 100 ms
			prio = 0
			stacksize = 1024
			msgblocksize = 32
			msgpoolsize = 10
		}
	}

	RuntimeClass RuntimeClass1 {
		model = multiThreaded
	}
}
\end{lstlisting}

The physical model defines the setup of your nodes with their attributes like threads and mode of execution. In this case we define one node with one thread. 

Similar for the mapping model model/HelloWorld.etmap which is used to deploy the logical system onto the physical system.

\begin{lstlisting}[language=etMap]
MappingModel MappingModel1 {
	import HelloWorld_Model.* from "HelloWorldC.room"
	import PhysicalModel1.* from "HelloWorldC.etphys"
	Mapping LogSys1 -> PhysSys1 {
		SubSystemMapping subSysRef1 -> nodeRef1 {
			ThreadMapping defaultThread -> PhysicalThread1
		}
	}
}
\end{lstlisting}

\input{015.1-hello-world-create-statemachine}

\subsection{Build and run the model}

Now the model is finished and the source code can be generated. The project wizard has created a launch 
configuration that is responsible for generating the source code. In the project \textit{HelloWorld} right click \emph{gen\_HelloWorld.launch} and run it as \emph{gen\_HelloWorld}. 

\includegraphics[width=0.8\textwidth]{images/015-HelloWorld06.png}

The source code for the model will be generated into the folder \emph{src-gen}. The main function will be contained in \emph{HelloWorld/Nod\_nodeRef1\_subSysRef1Runner.java}.
Select this file and run it as Java application or use the generated launch configuration \emph{run\_HelloWorld.launch}.

\includegraphics{images/015-HelloWorld07.png}


The Hello World application starts and the string \emph{"Hello World"} will be printed into the console window. To terminate the application the user must enter \emph{quit} in the console window.

\includegraphics[width=0.6\textwidth]{images/015-HelloWorld08.png}

\input{015.2-hello-world-open-msc}

\subsection{Summary}

Now you have generated your first \eTrice{} model from scratch. You can switch between diagram editor and 
textual model representation (.room file) and you can see what will be generated during editing and saving the diagram files. 
You should take a look at the generated source files to understand how the state machine is generated and 
the life cycle of the application works. The next tutorials will deal with more complex hierarchies in structure and behavior.
